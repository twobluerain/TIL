#### 조회(read.jsp) 및 조회수 증가

1. SQL UPDATE bbs SET viewcnt = viewcnt + 1 WHERE bbsno=1;
2. SELECT bbsno, wname, title, content, viewcnt, wdate FROM bbs WHERE bbsno = 1;

3. DAO 및 DAO Test

(1) DAO read 만들기

```
	public BbsDTO read(int bbsno) {
		BbsDTO dto = null;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		ResultSet rs = null;

		StringBuffer sql = new StringBuffer();
		sql.append("  SELECT bbsno, wname, title, content, viewcnt, wdate ");
		sql.append("  FROM bbs   ");
		sql.append("  WHERE bbsno = ?  ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setInt(1, bbsno);

			rs = pstmt.executeQuery();

			if(rs.next()) {
				dto = new BbsDTO();
				dto.setBbsno(rs.getInt("bbsno"));
				dto.setWname(rs.getString("wname"));
				dto.setTitle(rs.getString("title"));
				dto.setContent(rs.getString("content"));
				dto.setViewcnt(rs.getInt("viewcnt"));
				dto.setWdate(rs.getString("wdate"));
			}

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(rs, pstmt, con);
		}

		return dto;
	}

public void upViewcnt(int bbsno) {
	Connection con = DBOpen.getConnection();
	PreparedStatement pstmt = null;

	StringBuffer sql = new StringBuffer();
	sql.append(" UPDATE bbs 			   ");
	sql.append(" SET viewcnt = viewcnt + 1 ");
	sql.append(" WHERE bbsno = ?	       ");

	try {
		pstmt = con.prepareStatement(sql.toString());
		pstmt.setInt(1, bbsno);

		pstmt.executeUpdate();
	} catch (SQLException e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
	} finally {
		DBClose.close(pstmt, con);
	}
```

(2) DAO upViewcnt 만들기

```
	public void upViewcnt(int bbsno) {
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;

		StringBuffer sql = new StringBuffer();
		sql.append(" UPDATE bbs 			   ");
		sql.append(" SET viewcnt = viewcnt + 1 ");
		sql.append(" WHERE bbsno = ?	       ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setInt(1, bbsno);

			pstmt.executeUpdate();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}



	}
```

(3) read.jsp 만들기

```
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	dao.upViewcnt(bbsno);
	BbsDTO dto = dao.read(bbsno); // 레코드 조회

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1>조회</h1>
<div class = "panel panel-default">
	<div class="panel-heading">작성자</div>
	<div class="panel-body"><%=dto.getWname() %></div>
	<div class="panel-heading">제목</div>
	<div class="panel-body"><%=dto.getTitle() %></div>
	<div class="panel-heading">내용</div>
	<div class="panel-body" style='height:170px'><%=dto.getContent() %></div>
	<div class="panel-heading">조회수</div>
	<div class="panel-body"><%=dto.getViewcnt() %></div>
	<div class="panel-heading">등록일</div>
	<div class="panel-body"><%=dto.getWdate() %></div>
</div>
<div>
	<button type="button" class="btn" onclick="location.href='createForm.jsp'">등록</button>
	<button type="button" class="btn" onclick="updateM()">수정</button>
	<button type="button" class="btn" onclick="deleteM()">삭제</button>
	<button type="button" class="btn" onclick="location.href='list.jsp'">목록</button>
</div>
</div>
</body>
</html>
```

완성 후 1번 글(http://localhost:8000/webtest/bbs/read.jsp?bbsno=1)을 보았을 때

![img](https://blog.kakaocdn.net/dn/BoZeF/btrC4gSj0YW/P5JKuXAXxoiKQstbWuBA91/img.png)

---

---

게시글을 누르면 반응하게끔 만들기

list.jsp 수정하기

![image](https://user-images.githubusercontent.com/101780699/170158875-335e65b5-2b7c-4d0d-bf94-af86198ab193.png)

```java
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*, bbs.BbsDTO, utility.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%

//검색관련--------------
String col = Utility.checkNull(request.getParameter("col"));
String word = Utility.checkNull(request.getParameter("word"));

if(col.equals("total"))word = "";

//페이징 관련---------------
int nowPage = 1;
if(request.getParameter("nowPage") != null){
	nowPage = Integer.parseInt(request.getParameter("nowPage"));
}

int recordPerPage = 5;

int sno = ((nowPage -1) * recordPerPage);
int eno = recordPerPage;

Map map = new HashMap();
map.put("col",col);
map.put("word",word);
map.put("sno",sno);
map.put("eno",eno);

List<BbsDTO> list = dao.list(map);
int total = dao.total(map);
String paging = Utility.paging(total, nowPage, recordPerPage, col, word);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script type ="text/javascript">
  	function read(bbsno){
  		alert(bbsno);
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<form action="list.jsp" class='form-inline'>
<div class='form-group'>
 <select class='form-control' name='col'>
 	<option value="wname" <%if(col.equals("wname")) out.print("selected");%>>성명</option>
 	<option value="title" <%if(col.equals("title")) out.print("selected");%>>제목</option>
 	<option value="content" <%if(col.equals("content")) out.print("selected");%> >내용</option>
 	<option value="title_content" <%if(col.equals("title_content")) out.print("selected");%>>제목+내용</option>
 	<option value="total" <%if(col.equals("total")) out.print("selected");%>>전체출력</option>
 </select>
</div>
<div class="form-group">
	<input type='text' class='form-control' placeholder='Enter 검색어' name='word' value="<%=word%>">
</div>
<button class='btn btn-default'>검색</button>
<button class='btn btn-default' type='button' onclick="location.href='createForm.jsp'">등록</button>
</form>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
<%  if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

<%  }else {
		for(int i=0 ; i < list.size() ; i++) {
	   	BbsDTO dto = list.get(i);
%>
		<tr>
			<td><%=dto.getBbsno() %></td>
			<td><a href="javascript:read('<%=dto.getBbsno() %>')"><%=dto.getTitle() %></td>
			<td><%=dto.getWname() %></td>
			<td><%=dto.getWdate() %></td>
			<td><%=dto.getGrpno() %></td>
			<td><%=dto.getIndent() %></td>
			<td><%=dto.getAnsnum() %></td>
		</tr>
<%     } //for end
    } //if end
%>
	</tbody>
</table>
<div>
	<%=paging %>
</div>
</div>
</body>
</html>
```

누르면 그 글로 들어가기

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*, bbs.BbsDTO, utility.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%

//검색관련--------------
String col = Utility.checkNull(request.getParameter("col"));
String word = Utility.checkNull(request.getParameter("word"));

if(col.equals("total"))word = "";

//페이징 관련---------------
int nowPage = 1;
if(request.getParameter("nowPage") != null){
	nowPage = Integer.parseInt(request.getParameter("nowPage"));
}

int recordPerPage = 5;

int sno = ((nowPage -1) * recordPerPage);
int eno = recordPerPage;

Map map = new HashMap();
map.put("col",col);
map.put("word",word);
map.put("sno",sno);
map.put("eno",eno);

List<BbsDTO> list = dao.list(map);
int total = dao.total(map);
String paging = Utility.paging(total, nowPage, recordPerPage, col, word);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script type ="text/javascript">
  	function read(bbsno){
  		let url = 'read.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<form action="list.jsp" class='form-inline'>
<div class='form-group'>
 <select class='form-control' name='col'>
 	<option value="wname" <%if(col.equals("wname")) out.print("selected");%>>성명</option>
 	<option value="title" <%if(col.equals("title")) out.print("selected");%>>제목</option>
 	<option value="content" <%if(col.equals("content")) out.print("selected");%> >내용</option>
 	<option value="title_content" <%if(col.equals("title_content")) out.print("selected");%>>제목+내용</option>
 	<option value="total" <%if(col.equals("total")) out.print("selected");%>>전체출력</option>
 </select>
</div>
<div class="form-group">
	<input type='text' class='form-control' placeholder='Enter 검색어' name='word' value="<%=word%>">
</div>
<button class='btn btn-default'>검색</button>
<button class='btn btn-default' type='button' onclick="location.href='createForm.jsp'">등록</button>
</form>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
<%  if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

<%  }else {
		for(int i=0 ; i < list.size() ; i++) {
	   	BbsDTO dto = list.get(i);
%>
		<tr>
			<td><%=dto.getBbsno() %></td>
			<td><a href="javascript:read('<%=dto.getBbsno() %>')"><%=dto.getTitle() %></td>
			<td><%=dto.getWname() %></td>
			<td><%=dto.getWdate() %></td>
			<td><%=dto.getGrpno() %></td>
			<td><%=dto.getIndent() %></td>
			<td><%=dto.getAnsnum() %></td>
		</tr>
<%     } //for end
    } //if end
%>
	</tbody>
</table>
<div>
	<%=paging %>
</div>
</div>
</body>
</html>
```

---

---

#### 게시판 수정

1. 수정폼 생성

​ (1) DAO update 만들기

```java
	public boolean update(BbsDTO dto) {
		boolean flag = false;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;

		StringBuffer sql = new StringBuffer();
		sql.append("  UPDATE bbs   ");
		sql.append("  SET   ");
		sql.append("  	wname= 	 ?,  ");
		sql.append("  	title=	 ?,  ");
		sql.append("  	content= ?   ");
		sql.append("  WHERE bbsno = ?  ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setString(1, dto.getWname());
			pstmt.setString(2, dto.getTitle());
			pstmt.setString(3, dto.getContent());
			pstmt.setInt(4, dto.getBbsno());

			int cnt = pstmt.executeUpdate();
			if(cnt>0)flag = true;

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}


		return flag;
	}
```

수정 updateForm.jsp 만들기

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	BbsDTO dto = dao.read(bbsno);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 수정</h1>
<form class="form-horizontal"
      action="updateProc.jsp"
      method="post"
      >
  <input type="hidden" name="bbsno" value="<%=bbsno%>">
  <div class="form-group">
    <label class="control-label col-sm-2" for="wname">작성자</label>
    <div class="col-sm-6">
      <input type="text" name="wname" id="wname" class="form-control" value="<%=dto.getWname()%>">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="title">제목</label>
    <div class="col-sm-6">
      <input type="text" name="title" id="title" class="form-control" value="<%=dto.getWname()%>">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="content">내용</label>
    <div class="col-sm-6">
    <textarea rows="5" cols="5" id="content" name="content" class="form-control"  ><%=dto.getContent()%></textarea>
    </div>
  </div>

    <div class="form-group">
    <label class="control-label col-sm-2" for="passwd">비밀번호</label>
    <div class="col-sm-6">
      <input type="password" name="passwd" id="passwd" class="form-control">
    </div>
  </div>

   <div class="form-group">
   <div class="col-sm-offset-2 col-sm-5">
    <button class="btn">수정</button>
    <button type="reset" class="btn">취소</button>
   </div>
 </div>
</form>
</div>
</body>
</html>
```

list.jsp 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*, bbs.BbsDTO, utility.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%

//검색관련--------------
String col = Utility.checkNull(request.getParameter("col"));
String word = Utility.checkNull(request.getParameter("word"));

if(col.equals("total"))word = "";

//페이징 관련---------------
int nowPage = 1;
if(request.getParameter("nowPage") != null){
	nowPage = Integer.parseInt(request.getParameter("nowPage"));
}

int recordPerPage = 5;

int sno = ((nowPage -1) * recordPerPage);
int eno = recordPerPage;

Map map = new HashMap();
map.put("col",col);
map.put("word",word);
map.put("sno",sno);
map.put("eno",eno);

List<BbsDTO> list = dao.list(map);
int total = dao.total(map);
String paging = Utility.paging(total, nowPage, recordPerPage, col, word);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script type ="text/javascript">
  	function read(bbsno){
  		let url = 'read.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<form action="list.jsp" class='form-inline'>
<div class='form-group'>
 <select class='form-control' name='col'>
 	<option value="wname" <%if(col.equals("wname")) out.print("selected");%>>성명</option>
 	<option value="title" <%if(col.equals("title")) out.print("selected");%>>제목</option>
 	<option value="content" <%if(col.equals("content")) out.print("selected");%> >내용</option>
 	<option value="title_content" <%if(col.equals("title_content")) out.print("selected");%>>제목+내용</option>
 	<option value="total" <%if(col.equals("total")) out.print("selected");%>>전체출력</option>
 </select>
</div>
<div class="form-group">
	<input type='text' class='form-control' placeholder='Enter 검색어' name='word' value="<%=word%>">
</div>
<button class='btn btn-default'>검색</button>
<button class='btn btn-default' type='button' onclick="location.href='createForm.jsp'">등록</button>
</form>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
<%  if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

<%  }else {
		for(int i=0 ; i < list.size() ; i++) {
	   	BbsDTO dto = list.get(i);
%>
		<tr>
			<td><%=dto.getBbsno() %></td>
			<td><a href="javascript:read('<%=dto.getBbsno() %>')"><%=dto.getTitle() %></td>
			<td><%=dto.getWname() %></td>
			<td><%=dto.getWdate() %></td>
			<td><%=dto.getGrpno() %></td>
			<td><%=dto.getIndent() %></td>
			<td><%=dto.getAnsnum() %></td>
		</tr>
<%     } //for end
    } //if end
%>
	</tbody>
</table>
<div>
	<%=paging %>
</div>
</div>
</body>
</html>
```

read.jsp 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	dao.upViewcnt(bbsno);
	BbsDTO dto = dao.read(bbsno); // 레코드 조회

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script>
  	function update(bbsno){
  		// alert(bbsno);
  		let url = 'updateForm.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1>조회</h1>
<div class = "panel panel-default">
	<div class="panel-heading">작성자</div>
	<div class="panel-body"><%=dto.getWname() %></div>
	<div class="panel-heading">제목</div>
	<div class="panel-body"><%=dto.getTitle() %></div>
	<div class="panel-heading">내용</div>
	<div class="panel-body" style='height:170px'><%=dto.getContent() %></div>
	<div class="panel-heading">조회수</div>
	<div class="panel-body"><%=dto.getViewcnt() %></div>
	<div class="panel-heading">등록일</div>
	<div class="panel-body"><%=dto.getWdate() %></div>
</div>
<div>
	<button type="button" class="btn" onclick="location.href='createForm.jsp'">등록</button>
	<button type="button" class="btn" onclick="update('<%=bbsno%>')">수정</button>
	<button type="button" class="btn" onclick="deleteM()">삭제</button>
	<button type="button" class="btn" onclick="location.href='list.jsp'">목록</button>
</div>
</div>
</body>
</html>
```

수정을 눌렀을 때

![image](https://user-images.githubusercontent.com/101780699/170175679-a1823395-1d95-477f-9c11-d0c3fa7ef418.png)

---

#### 게시판 수정

updateProc.jsp 생성

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    import="bbs.*, java.util.* "%>

<% request.setCharacterEncoding("utf-8"); %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<jsp:useBean id="dto" class="bbs.BbsDTO" />
<%//  String wname = request.getParameter("wname"); 랑    dto.setWname(wname); 합친 코드 */ %>
<%//  property 에서 '*'를 쓰면 모든 속성 된다.' */ %>
<jsp:setProperty name="dto" property="*" />

<%
	Map map = new HashMap();
	map.put("bbsno", dto.getBbsno());
	map.put("passwd", dto.getPasswd());
	boolean pflag = dao.passCheck(map);
	boolean flag = false;
	if(pflag) {  //올바른 비밀번호

		flag = dao.update(dto);  //수정처리
	}

    %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<jsp:include page="/menu/top.jsp"></jsp:include>
<div class="container">
	<div class="well well-lg">
	<%
		if(!pflag) { //비번 잘못되었을 때
			out.print("잘못된 비밀번호 입니다.");
		} else if(flag){
			out.print("글 수정 성공입니다.");
		} else {
			out.print("글 수정 실패입니다.");
		}
	%>
	</div>

	<% if(!pflag) { %>
		<button class = 'btn' onclick="history.back()">다시시도</button>
	<% } %>
	<button class='btn' onclick="location.href='createForm.jsp'">다시등록</button>
	<button class='btn' onclick="location.href='list.jsp'">목록으로</button>
</div>

</body>
</html>
```

updateForm.jsp 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	BbsDTO dto = dao.read(bbsno);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 글 수정</h1>
<form class="form-horizontal"
      action="updateProc.jsp"
      method="post"
      >
  <input type="hidden" name='bbsno' value="<%=bbsno%>">
  <div class="form-group">
    <label class="control-label col-sm-2" for="wname">작성자</label>
    <div class="col-sm-6">
      <input type="text" name="wname" id="wname" class="form-control" value="<%=dto.getWname()%>">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="title">제목</label>
    <div class="col-sm-6">
      <input type="text" name="title" id="title" class="form-control" value="<%=dto.getWname()%>">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="content">내용</label>
    <div class="col-sm-6">
    <textarea rows="5" cols="5" id="content" name="content" class="form-control"><%=dto.getContent()%></textarea>
    </div>
  </div>

    <div class="form-group">
    <label class="control-label col-sm-2" for="passwd">비밀번호</label>
    <div class="col-sm-6">
      <input type="password" name="passwd" id="passwd" class="form-control">
    </div>
  </div>

   <div class="form-group">
   <div class="col-sm-offset-2 col-sm-5">
    <button class="btn">수정</button>
    <button type="reset" class="btn">취소</button>
   </div>
 </div>
</form>
</div>
</body>
</html>
```

list.jsp 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*, bbs.BbsDTO, utility.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%

//검색관련--------------
String col = Utility.checkNull(request.getParameter("col"));
String word = Utility.checkNull(request.getParameter("word"));

if(col.equals("total"))word = "";

//페이징 관련---------------
int nowPage = 1;
if(request.getParameter("nowPage") != null){
	nowPage = Integer.parseInt(request.getParameter("nowPage"));
}

int recordPerPage = 5;

int sno = ((nowPage -1) * recordPerPage);
int eno = recordPerPage;

Map map = new HashMap();
map.put("col",col);
map.put("word",word);
map.put("sno",sno);
map.put("eno",eno);

List<BbsDTO> list = dao.list(map);
int total = dao.total(map);
String paging = Utility.paging(total, nowPage, recordPerPage, col, word);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script type ="text/javascript">
  	function read(bbsno){
  		let url = 'read.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<form action="list.jsp" class='form-inline'>
<div class='form-group'>
 <select class='form-control' name='col'>
 	<option value="wname" <%if(col.equals("wname")) out.print("selected");%>>성명</option>
 	<option value="title" <%if(col.equals("title")) out.print("selected");%>>제목</option>
 	<option value="content" <%if(col.equals("content")) out.print("selected");%> >내용</option>
 	<option value="title_content" <%if(col.equals("title_content")) out.print("selected");%>>제목+내용</option>
 	<option value="total" <%if(col.equals("total")) out.print("selected");%>>전체출력</option>
 </select>
</div>
<div class="form-group">
	<input type='text' class='form-control' placeholder='Enter 검색어' name='word' value="<%=word%>">
</div>
<button class='btn btn-default'>검색</button>
<button class='btn btn-default' type='button' onclick="location.href='createForm.jsp'">등록</button>
</form>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
<%  if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

<%  }else {
		for(int i=0 ; i < list.size() ; i++) {
	   	BbsDTO dto = list.get(i);
%>
		<tr>
			<td><%=dto.getBbsno() %></td>
			<td><a href="javascript:read('<%=dto.getBbsno() %>')"><%=dto.getTitle() %></td>
			<td><%=dto.getWname() %></td>
			<td><%=dto.getWdate() %></td>
			<td><%=dto.getGrpno() %></td>
			<td><%=dto.getIndent() %></td>
			<td><%=dto.getAnsnum() %></td>
		</tr>
<%     } //for end
    } //if end
%>
	</tbody>
</table>
<div>
	<%=paging %>
</div>
</div>
</body>
</html>
```

read.jsp 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	dao.upViewcnt(bbsno);
	BbsDTO dto = dao.read(bbsno); // 레코드 조회

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script>
  	function update(bbsno){
  		// alert(bbsno);
  		let url = 'updateForm.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1>조회</h1>
<div class = "panel panel-default">
	<div class="panel-heading">작성자</div>
	<div class="panel-body"><%=dto.getWname() %></div>
	<div class="panel-heading">제목</div>
	<div class="panel-body"><%=dto.getTitle() %></div>
	<div class="panel-heading">내용</div>
	<div class="panel-body" style='height:170px'><%=dto.getContent() %></div>
	<div class="panel-heading">조회수</div>
	<div class="panel-body"><%=dto.getViewcnt() %></div>
	<div class="panel-heading">등록일</div>
	<div class="panel-body"><%=dto.getWdate() %></div>
</div>
<div>
	<button type="button" class="btn" onclick="location.href='createForm.jsp'">등록</button>
	<button type="button" class="btn" onclick="update('<%=bbsno%>')">수정</button>
	<button type="button" class="btn" onclick="deleteM()">삭제</button>
	<button type="button" class="btn" onclick="location.href='list.jsp'">목록</button>
</div>
</div>
</body>
</html>
```

![image](https://user-images.githubusercontent.com/101780699/170167469-642b05bd-0879-42e0-a291-b850c05d760b.png)

![image](https://user-images.githubusercontent.com/101780699/170175586-f5465d17-1d5b-4618-a5e6-3d792cb55bc6.png)

---

---

2. 패스워드 검사

   (2) DAO passCheck 만들기

```java
	public boolean passCheck(Map map) {
		boolean flag = false;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		ResultSet rs = null;

		StringBuffer sql = new StringBuffer();
		sql.append("  SELECT COUNT(bbsno) as cnt   ");
		sql.append("  FROM bbs 			   ");
		sql.append("  WHERE bbsno	=	?  ");
		sql.append("  AND passwd	=	?  ");

		int bbsno = (int)map.get("bbsno");
		String passwd = (String)map.get("passwd");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setInt(1, bbsno);
			pstmt.setString(2, passwd);

			rs = pstmt.executeQuery();
			rs.next();
			int cnt = rs.getInt("cnt");
			if(cnt>0)flag = true; // 패스워드가 맞다면
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(rs, pstmt, con);
		}

		return flag;
	}
```

---

---

#### 게시판 삭제

삭제처리 위해 패스워드입력 페이지 제작

(1) deleteForm.jsp 만들기

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	BbsDTO dto = dao.read(bbsno);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <style type="text/css">
 	#red{
  	color : red;}
  </style>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">삭제</h1>
<form class="form-horizontal"
      action="deleteProc.jsp"
      method="post"
      >
  <input type="hidden" name="bbsno" value="<%=request.getParameter("bbsno") %>">
    <div class="form-group">
    <label class="control-label col-sm-2" for="passwd">비밀번호</label>
    <div class="col-sm-6">
      <input type="password" name="passwd" id="passwd" class="form-control">
    </div>
  </div>

  <p id="red" class="col-sm-offset-2 col-sm-6">삭제 후 복구할 수 없습니다.</p>


   <div class="form-group">
   <div class="col-sm-offset-2 col-sm-5">
    <button class="btn">삭제</button>
    <button type="reset" class="btn">취소</button>
   </div>
 </div>
</form>
</div>
</body>
</html>
```

(2) read.jsp 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	dao.upViewcnt(bbsno);
	BbsDTO dto = dao.read(bbsno); // 레코드 조회

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script>
  	function update(bbsno){
  		// alert(bbsno);
  		let url = 'updateForm.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  	function del(bbsno){
  		// alert(bbsno);
  		let url = 'deleteForm.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1>조회</h1>
<div class = "panel panel-default">
	<div class="panel-heading">작성자</div>
	<div class="panel-body"><%=dto.getWname() %></div>
	<div class="panel-heading">제목</div>
	<div class="panel-body"><%=dto.getTitle() %></div>
	<div class="panel-heading">내용</div>
	<div class="panel-body" style='height:170px'><%=dto.getContent() %></div>
	<div class="panel-heading">조회수</div>
	<div class="panel-body"><%=dto.getViewcnt() %></div>
	<div class="panel-heading">등록일</div>
	<div class="panel-body"><%=dto.getWdate() %></div>
</div>
<div>
	<button type="button" class="btn" onclick="location.href='createForm.jsp'">등록</button>
	<button type="button" class="btn" onclick="update('<%=bbsno%>')">수정</button>
	<button type="button" class="btn" onclick="del('<%=bbsno%>')">삭제</button>
	<button type="button" class="btn" onclick="location.href='list.jsp'">목록</button>
</div>
</div>
</body>
</html>
```

![image](https://user-images.githubusercontent.com/101780699/170180352-99fa98ef-b791-4a9d-af05-e2f0282ea49e.png)

(3) DAO delete 만들기

```java
	public boolean delete(int bbsno) {
		boolean flag = false;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;

		StringBuffer sql = new StringBuffer();
		sql.append("  delete from bbs  ");
		sql.append("  where bbsno = ?  ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setInt(1, bbsno);

			int cnt = pstmt.executeUpdate();
			if(cnt>0) flag = true;
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}
		return flag;
	}

```

(4) deleteProc.jsp 만들기

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    import="bbs.*, java.util.* "%>

<% request.setCharacterEncoding("utf-8"); %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />

<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	String passwd = request.getParameter("passwd");

	Map map = new HashMap();
	map.put("bbsno", bbsno);
	map.put("passwd", passwd);
	boolean pflag = dao.passCheck(map);
	boolean flag = false;
	if(pflag) {  //올바른 비밀번호

		flag = dao.delete(bbsno);  //수정처리
	}

    %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<jsp:include page="/menu/top.jsp"></jsp:include>
<div class="container">
	<div class="well well-lg">
	<%
		if(!pflag) { //비번 잘못되었을 때
			out.print("잘못된 비밀번호 입니다.");
		} else if(flag){
			out.print("글 삭제 성공입니다.");
		} else {
			out.print("글 삭제 실패입니다.");
		}
	%>
	</div>

	<% if(!pflag) { %>
		<button class = 'btn' onclick="history.back()">다시시도</button>
	<% } %>
	<button class='btn' onclick="location.href='createForm.jsp'">다시등록</button>
	<button class='btn' onclick="location.href='list.jsp'">목록으로</button>
</div>

</body>
</html>
```

![image](https://user-images.githubusercontent.com/101780699/170181604-8f6bcf82-087a-4f9d-bfee-6572023e986d.png)

![image](https://user-images.githubusercontent.com/101780699/170181648-8b13396d-e412-47b6-a496-c192e8a28630.png)

---

---

#### 게시판 답변 처리

SQL문 확인

기존 데이터를 삭제한 후 grpno를 가진 데이터로 추가하기

![image](https://user-images.githubusercontent.com/101780699/170187677-1720e143-8ea7-48e2-b3b1-68fcdaec39cc.png)

DAO create 수정

```java
	public boolean create(BbsDTO dto) {
		boolean flag = false;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		StringBuffer sql = new StringBuffer();
			sql.append(" insert into bbs(wname, title, content, passwd, wdate, grpno) ");
	        sql.append(" values(?,?,?,?,sysdate(),  ");
	        sql.append(" (SELECT ifnull(MAX(grpno),0) + 1 FROM bbs b)) ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setString(1, dto.getWname());
			pstmt.setString(2, dto.getTitle());
			pstmt.setString(3, dto.getContent());
			pstmt.setString(4, dto.getPasswd());

			int cnt = pstmt.executeUpdate();

			if(cnt>0) flag = true;

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}

		return flag;
	}
```

read.jsp 답변 버튼 추가

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	dao.upViewcnt(bbsno);
	BbsDTO dto = dao.read(bbsno); // 레코드 조회

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script>
  	function update(bbsno){ // 수정 페이지 이동
  		// alert(bbsno);
  		let url = 'updateForm.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  	function del(bbsno){ // 삭제 페이지 이동
  		// alert(bbsno);
  		let url = 'deleteForm.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  	function reply(bbsno){ // 답변 페이지 이동
  		// alert(bbsno);
  		let url = 'replyForm.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1>조회</h1>
<div class = "panel panel-default">
	<div class="panel-heading">작성자</div>
	<div class="panel-body"><%=dto.getWname() %></div>
	<div class="panel-heading">제목</div>
	<div class="panel-body"><%=dto.getTitle() %></div>
	<div class="panel-heading">내용</div>
	<div class="panel-body" style='height:170px'><%=dto.getContent() %></div>
	<div class="panel-heading">조회수</div>
	<div class="panel-body"><%=dto.getViewcnt() %></div>
	<div class="panel-heading">등록일</div>
	<div class="panel-body"><%=dto.getWdate() %></div>
</div>
<div>
	<button type="button" class="btn" onclick="location.href='createForm.jsp'">등록</button>
	<button type="button" class="btn" onclick="update('<%=bbsno%>')">수정</button>
	<button type="button" class="btn" onclick="del('<%=bbsno%>')">삭제</button>
	<button type="button" class="btn" onclick="reply('<%=bbsno%>')">답변</button>
	<button type="button" class="btn" onclick="location.href='list.jsp'">목록</button>
</div>
</div>
</body>
</html>
```

replyForm.jsp 만들기

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
    int bbsno = Integer.parseInt(request.getParameter("bbsno"));
 	BbsDTO dto = dao.readReply(bbsno);
 %>

<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 답변</h1>
<form class="form-horizontal"
      action="replyProc.jsp"
      method="post"
      >

  <input type="hidden" name="bbsno" value="<%=dto.getBbsno() %>">
  <input type="hidden" name="grpno" value="<%=dto.getGrpno() %>">
  <input type="hidden" name="indent" value="<%=dto.getIndent() %>">
  <input type="hidden" name="ansnum" value="<%=dto.getAnsnum() %>">

  <div class="form-group">
    <label class="control-label col-sm-2" for="wname">작성자</label>
    <div class="col-sm-6">
      <input type="text" name="wname" id="wname" class="form-control">
    </div>
  </div>
  <div class="form-group">
    <label class="control-label col-sm-2" for="title">제목</label>
    <div class="col-sm-8">
      <input type="text" name="title" id="title"
      class="form-control" value="<%=dto.getTitle()%>">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="content">내용</label>
    <div class="col-sm-8">
    <textarea rows="12" cols="7" id="content" name="content" class="form-control"></textarea>
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="passwd">비밀번호</label>
    <div class="col-sm-6">
      <input type="password" name="passwd" id="passwd" class="form-control">
    </div>
  </div>

   <div class="form-group">
   <div class="col-sm-offset-2 col-sm-5">
    <button class="btn">등록</button>
    <button type="reset" class="btn">취소</button>
   </div>
 </div>
</form>
</div>
</body>
</html>
```

DAO readReply 추가

```java
	public BbsDTO readReply(int bbsno) {
		BbsDTO dto = null;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		ResultSet rs = null;

		StringBuffer sql = new StringBuffer();
		sql.append("  SELECT bbsno, title, grpno, indent, ansnum ");
		sql.append("  FROM bbs   ");
		sql.append("  WHERE bbsno = ?  ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setInt(1, bbsno);

			rs = pstmt.executeQuery();

			if(rs.next()) {
				dto = new BbsDTO();
				dto.setBbsno(rs.getInt("bbsno"));
				dto.setTitle(rs.getString("title"));
				dto.setGrpno(rs.getInt("grpno"));
				dto.setIndent(rs.getInt("indent"));
				dto.setAnsnum(rs.getInt("ansnum"));
			}

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(rs, pstmt, con);
		}

		return dto;
	}
```

![image](https://user-images.githubusercontent.com/101780699/170190513-0f8fa00e-d878-46e3-8285-e5efade83fa8.png)

---

#### 답변처리 페이지 제작

\- 기존 답변의 순서인 ansnum 값을 변경
\- 답변 생성시 부모의 grpno, indent+1, ansnum+1 로 생성

DAO createReply 추가하기

```java
	public boolean createReply(BbsDTO dto) {
		boolean flag = false;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		StringBuffer sql = new StringBuffer();
			sql.append(" insert into bbs(wname, title, content, passwd, wdate, grpno, indent, ansnum) ");
	        sql.append(" values(?,?,?,?,sysdate(),?,?,?)  ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setString(1, dto.getWname());
			pstmt.setString(2, dto.getTitle());
			pstmt.setString(3, dto.getContent());
			pstmt.setString(4, dto.getPasswd());
			pstmt.setInt(5, dto.getGrpno());
			pstmt.setInt(6, dto.getIndent()+1);
			pstmt.setInt(7, dto.getAnsnum()+1);

			int cnt = pstmt.executeUpdate();

			if(cnt>0) flag = true;

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}

		return flag;
	}
```

DAO upAnsnum 추가하기

```java
	public void upAnsnum(Map map) {
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		StringBuffer sql = new StringBuffer();
		sql.append(" update bbs ");
		sql.append(" set ");
		sql.append(" ansnum = ansnum + 1  ");
		sql.append(" where grpno = ? and ansnum > ?   ");

		int grpno = (int)map.get("grpno");
		int ansnum = (int)map.get("ansnum");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setInt(1, grpno);
			pstmt.setInt(2, ansnum);

			pstmt.executeUpdate();

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}
	}
```

replyProc.jsp 만들기

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    import="bbs.*, java.util.* "%>

<% request.setCharacterEncoding("utf-8"); %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<jsp:useBean id="dto" class="bbs.BbsDTO" />
<%//  String wname = request.getParameter("wname"); 랑    dto.setWname(wname); 합친 코드 */ %>
<%//  property 에서 '*'를 쓰면 모든 속성 된다.' */ %>
<jsp:setProperty name="dto" property="*" />

<%
	Map map = new HashMap();
	map.put("grpno", dto.getGrpno());
	map.put("ansnum", dto.getAnsnum());
	dao.upAnsnum(map);
	boolean flag = dao.createReply(dto); // 답변
%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<jsp:include page="/menu/top.jsp"></jsp:include>
<div class="container">
	<div class="well well-lg">
	<%
		if(flag){
			out.print("답변 성공입니다.");
		} else {
			out.print("답변 실패입니다.");
		}
	%>
	</div>
	<button class='btn' onclick="location.href='createForm.jsp'">다시등록</button>
	<button class='btn' onclick="location.href='list.jsp'">목록으로</button>
</div>

</body>
</html>
```

list.jsp 수정 td 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*, bbs.BbsDTO, utility.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%

//검색관련--------------
String col = Utility.checkNull(request.getParameter("col"));
String word = Utility.checkNull(request.getParameter("word"));

if(col.equals("total"))word = "";

//페이징 관련---------------
int nowPage = 1;
if(request.getParameter("nowPage") != null){
	nowPage = Integer.parseInt(request.getParameter("nowPage"));
}

int recordPerPage = 5;

int sno = ((nowPage -1) * recordPerPage);
int eno = recordPerPage;

Map map = new HashMap();
map.put("col",col);
map.put("word",word);
map.put("sno",sno);
map.put("eno",eno);

List<BbsDTO> list = dao.list(map);
int total = dao.total(map);
String paging = Utility.paging(total, nowPage, recordPerPage, col, word);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script type ="text/javascript">
  	function read(bbsno){
  		let url = 'read.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<form action="list.jsp" class='form-inline'>
<div class='form-group'>
 <select class='form-control' name='col'>
 	<option value="wname" <%if(col.equals("wname")) out.print("selected");%>>성명</option>
 	<option value="title" <%if(col.equals("title")) out.print("selected");%>>제목</option>
 	<option value="content" <%if(col.equals("content")) out.print("selected");%> >내용</option>
 	<option value="title_content" <%if(col.equals("title_content")) out.print("selected");%>>제목+내용</option>
 	<option value="total" <%if(col.equals("total")) out.print("selected");%>>전체출력</option>
 </select>
</div>
<div class="form-group">
	<input type='text' class='form-control' placeholder='Enter 검색어' name='word' value="<%=word%>">
</div>
<button class='btn btn-default'>검색</button>
<button class='btn btn-default' type='button' onclick="location.href='createForm.jsp'">등록</button>
</form>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
<%  if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

<%  }else {
		for(int i=0 ; i < list.size() ; i++) {
	   	BbsDTO dto = list.get(i);
%>
		<tr>
			<td><%=dto.getBbsno() %></td>
			<td>
				<%
					for(int j=0; j<dto.getIndent(); j++){
						out.print("&nbsp;&nbsp;");
					}
					if(dto.getIndent()>0) out.print("<img src='../images/re.jpg'>"); //re 이미지
				%>
			<a href="javascript:read('<%=dto.getBbsno() %>')"><%=dto.getTitle() %></td>
			<td><%=dto.getWname() %></td>
			<td><%=dto.getWdate() %></td>
			<td><%=dto.getGrpno() %></td>
			<td><%=dto.getIndent() %></td>
			<td><%=dto.getAnsnum() %></td>
		</tr>
<%     } //for end
    } //if end
%>
	</tbody>
</table>
<div>
	<%=paging %>
</div>
</div>
</body>
</html>
```

이미지를 다운받은 후 답변을 작성한 모습

![image](https://user-images.githubusercontent.com/101780699/170197621-65eafe4c-5efb-4a07-a68a-d66a11e454f2.png)

---

---

#### 새로운글에 new 이미지 표시

BbsDAO.java list(map) 메소드에서 wdate 가져오도록 수정

SQL 쿼리문

![image](https://user-images.githubusercontent.com/101780699/170207268-2b27cd80-7019-42d0-8577-d5e3efe40041.png)

utility.java 수정하기

```java
package utility;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.List;

public class Utility {

	public static String checkNull(String str) {
		if(str == null) {
			str = "";
		}
		return str;
	}

/**
 * @param totalRecord 전체 레코드수
 * @param nowPage     현재 페이지
 * @param recordPerPage 페이지당 레코드 수
 * @param col 검색 컬럼
 * @param word 검색어
 * @return 페이징 생성 문자열
 */
public static String paging(int totalRecord, int nowPage, int recordPerPage, String col, String word){
    int pagePerBlock = 5; // 블럭당 페이지 수
    int totalPage = (int)(Math.ceil((double)totalRecord/recordPerPage)); // 전체 페이지
    int totalGrp = (int)(Math.ceil((double)totalPage/pagePerBlock));// 전체 그룹
    int nowGrp = (int)(Math.ceil((double)nowPage/pagePerBlock));    // 현재 그룹
    int startPage = ((nowGrp - 1) * pagePerBlock) + 1; // 특정 그룹의 페이지 목록 시작
    int endPage = (nowGrp * pagePerBlock);             // 특정 그룹의 페이지 목록 종료

    StringBuffer str = new StringBuffer();
    str.append("<div style='text-align:center'>");
    str.append("<ul class='pagination'> ");
    int _nowPage = (nowGrp-1) * pagePerBlock; // 10개 이전 페이지로 이동
    if (nowGrp >= 2){
      str.append("<li><a href='./list.jsp?col="+col+"&word="+word+"&nowPage="+_nowPage+"'>이전</A></li>");
    }

    for(int i=startPage; i<=endPage; i++){
      if (i > totalPage){
        break;
      }

      if (nowPage == i){
        str.append("<li class='active'><a href=#>"+i+"</a></li>");
      }else{
        str.append("<li><a href='./list.jsp?col="+col+"&word="+word+"&nowPage="+i+"'>"+i+"</A></li>");
      }
    }

    _nowPage = (nowGrp * pagePerBlock)+1; // 10개 다음 페이지로 이동
    if (nowGrp < totalGrp){
      str.append("<li><A href='./list.jsp?col="+col+"&word="+word+"&nowPage="+_nowPage+"'>다음</A></li>");
    }
    str.append("</ul>");
    str.append("</div>");

    return str.toString();
 }
public static List<String> getDay(){
    List<String> list = new ArrayList<String>();

    SimpleDateFormat sd = new SimpleDateFormat("yyyy-MM-dd");
    Calendar cal = Calendar.getInstance();
    for(int j = 0; j < 3; j++){
        list.add(sd.format(cal.getTime()));
        cal.add(Calendar.DATE, -1);
    }

    return list;
}
/**
 * 등록날짜와 오늘,어제,그제날짜와 비교
 * @param wdate - 등록날짜
 * @return - true:오늘,어제,그제중 등록날짜와 같음
 *           false:오늘,어제,그제 날짜가 등록날짜와 다 다름
 */
public static boolean compareDay(String wdate){
    boolean flag = false;
    List<String> list = getDay();
    if(wdate.equals(list.get(0))
       || wdate.equals(list.get(1))
       || wdate.equals(list.get(2))){
        flag = true;
    }

    return flag;
}

}
```

list.jsp 수정하기

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*, bbs.BbsDTO, utility.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%

//검색관련--------------
String col = Utility.checkNull(request.getParameter("col"));
String word = Utility.checkNull(request.getParameter("word"));

if(col.equals("total"))word = "";

//페이징 관련---------------
int nowPage = 1;
if(request.getParameter("nowPage") != null){
	nowPage = Integer.parseInt(request.getParameter("nowPage"));
}

int recordPerPage = 5;

int sno = ((nowPage -1) * recordPerPage);
int eno = recordPerPage;

Map map = new HashMap();
map.put("col",col);
map.put("word",word);
map.put("sno",sno);
map.put("eno",eno);

List<BbsDTO> list = dao.list(map);
int total = dao.total(map);
String paging = Utility.paging(total, nowPage, recordPerPage, col, word);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script type ="text/javascript">
  	function read(bbsno){
  		let url = 'read.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<form action="list.jsp" class='form-inline'>
<div class='form-group'>
 <select class='form-control' name='col'>
 	<option value="wname" <%if(col.equals("wname")) out.print("selected");%>>성명</option>
 	<option value="title" <%if(col.equals("title")) out.print("selected");%>>제목</option>
 	<option value="content" <%if(col.equals("content")) out.print("selected");%> >내용</option>
 	<option value="title_content" <%if(col.equals("title_content")) out.print("selected");%>>제목+내용</option>
 	<option value="total" <%if(col.equals("total")) out.print("selected");%>>전체출력</option>
 </select>
</div>
<div class="form-group">
	<input type='text' class='form-control' placeholder='Enter 검색어' name='word' value="<%=word%>">
</div>
<button class='btn btn-default'>검색</button>
<button class='btn btn-default' type='button' onclick="location.href='createForm.jsp'">등록</button>
</form>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
<%  if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

<%  }else {
		for(int i=0 ; i < list.size() ; i++) {
	   	BbsDTO dto = list.get(i);
%>
		<tr>
			<td><%=dto.getBbsno() %></td>
			<td>
				<%
					for(int j=0; j<dto.getIndent(); j++){
						out.print("&nb sp;&nbsp;");
					}
					if(dto.getIndent()>0) out.print("<img src='../images/re.jpg'>"); //re 이미지
				%>
			<a href="javascript:read('<%=dto.getBbsno() %>')"><%=dto.getTitle() %></a>
			<% if(Utility.compareDay(dto.getWdate())){ %>
				<img src="../images/new.gif">
			<% } %>
			</td>
			<td><%=dto.getWname() %></td>
			<td><%=dto.getWdate() %></td>
			<td><%=dto.getGrpno() %></td>
			<td><%=dto.getIndent() %></td>
			<td><%=dto.getAnsnum() %></td>
		</tr>
<%     } //for end
    } //if end
%>
	</tbody>
</table>
<div>
	<%=paging %>
</div>
</div>
</body>
</html>
```

최근에 작성된 new.gif가 보여지는 모습

![image](https://user-images.githubusercontent.com/101780699/170209078-2fd45fb4-0119-4365-88cd-4f70afa99d79.png)

---

---

#### 주소록 만들기

SQL문 가져오기

![image](https://user-images.githubusercontent.com/101780699/170216620-53bb4d4d-4fc9-4252-ad7e-86b14ffca394.png)

```sql
use webtest;

       CREATE TABLE address(
         addressnum INT                NOT NULL AUTO_INCREMENT PRIMARY KEY, -- 번호
         name         VARCHAR(10)     NULL , -- 이름
         handphone  VARCHAR(14)     NULL , -- 핸드폰번호
         zipcode 	VARCHAR(10)		NULL,  -- 우편번호
         address      VARCHAR(500)     NULL,  -- 주소
         address2      VARCHAR(500)     NULL   -- 상세주소
     );

    INSERT INTO address(name, handphone, address, zipcode, address2)
    VALUES('개발자1', '000-123-1234', '대한민국', '12345', '12-345');
    INSERT INTO address(name, handphone, address, zipcode, address2)
    VALUES('개발자2', '111-123-1234', '일본', '12345', '54-321');
    INSERT INTO address(name, handphone, address, zipcode, address2)
    VALUES('개발자3', '222-123-1234', '러시아', '12345', '111-23');

    SELECT addressnum, name, handphone, address
    FROM address;

    SELECT addressnum, name, handphone, address , zipcode, address2
    FROM address WHERE addressnum=1;

    UPDATE address
    SET handphone='555-555-5555',
		address='터키' ,
		zipcode = '11111',
        address2 = '123-00'
    WHERE addressnum=1;

    DELETE FROM address WHERE addressnum=3;

    SELECT addressnum, name, handphone, address
    FROM address ORDER BY name DESC
    limit 0, 3; -- 오름차순은 ASC

    DELETE FROM address;
        drop table address;
```

top.jsp 수정하기

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%	String root = request.getContextPath(); %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>
<body>
	<div class="container">

  <div class="page-header row">
   <div class="col-sm-4">
    <img src="<%=root %>/images/img_chania.jpg" class="img-responsive img-thumbnail" alt="Cinque Terre" >
   </div>
   <div class="col-sm-8"><h1>Homepage</h1></div>
  </div>
  <ul class="nav nav-tabs">
    <li class="active"><a href="<%=root%>/index.jsp">Home</a></li>
    <li class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">게시판<span class="caret"></span></a>
      <ul class="dropdown-menu">
        <li><a href="<%=root%>/bbs/createForm.jsp">생성</a></li>
        <li><a href="<%=root%>/bbs/list.jsp">목록</a></li>
      </ul>
    </li>
    <li class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">메모<span class="caret"></span></a>
      <ul class="dropdown-menu">
        <li><a href="<%=root%>/memo/createForm.jsp">생성</a></li>
        <li><a href="<%=root%>/memo/list.jsp">목록</a></li>
      </ul>
    </li>
        <li class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">주소록<span class="caret"></span></a>
      <ul class="dropdown-menu">
        <li><a href="<%=root%>/addr/createForm.jsp">생성</a></li>
        <li><a href="<%=root%>/addr/list.jsp">목록</a></li>
      </ul>
    </li>
    <li><a href="#">Menu 2</a></li>
    <li><a href="#">Menu 3</a></li>
  </ul>
</div>
</body>
</html>
```

주소록에 생성과 목록 만들기

![image](https://user-images.githubusercontent.com/101780699/170210918-0a7825fe-1aa7-4f85-b187-7623d15a1981.png)

새로운 폴더 addr을 만들어 그 안에 createForm.jsp 만들기

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>

<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">주소등록</h1>
<form class="form-horizontal"
      action="createProc.jsp"
      method="post"
      >

  <div class="form-group">
    <label class="control-label col-sm-2" for="name">이름</label>
    <div class="col-sm-6">
      <input type="text" name="name" id="name" class="form-control">
    </div>
  </div>

    <div class="form-group">
    <label class="control-label col-sm-2" for="handphone">전화번호</label>
    <div class="col-sm-6">
      <input type="text" name="handphone" id="handphone" class="form-control">
    </div>
  </div>

   <div class="form-group">
    <label class="control-label col-sm-2" for="zipcode">우편번호</label>
    <div class="col-sm-2">
      <input type="text" name="zipcode" id="zipcode" class="form-control">
    </div>
    <button class='btn'>주소검색</button>
  </div>

   <div class="form-group">
    <label class="control-label col-sm-2" for="address">주소</label>
    <div class="col-sm-6">
      <input type="text" name="address" id="address" class="form-control">
    </div>
  </div>

    <div class="form-group">
    <label class="control-label col-sm-2" for="address2">상세주소</label>
    <div class="col-sm-6">
      <input type="text" name="address2" id="address2" class="form-control">
    </div>
  </div>

   <div class="form-group">
   <div class="col-sm-offset-2 col-sm-5">
    <button class="btn">등록</button>
    <button type="reset" class="btn">취소</button>
   </div>
 </div>
</form>
</div>
</body>
</html>
```

주소록 생성 버튼을 누르면 나오는 화면

![image](https://user-images.githubusercontent.com/101780699/170217388-d7db6b58-9b8e-460e-a50c-e34d5d2bdf60.png)

---

#### 주소 검색을 눌렀을 때 생성되는 팝업 만들기.

createForm.jsp에 우편번호 팝업 코드를 복사해 붙여넣기

우편번호 팝업코드 : [https://postcode.map.daum.net/guide﻿](https://postcode.map.daum.net/guide)

```java
<%@ page contentType="text/html; charset=UTF-8" %>

<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
    function sample6_execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var addr = ''; // 주소 변수
                var extraAddr = ''; // 참고항목 변수

                //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                    addr = data.roadAddress;
                } else { // 사용자가 지번 주소를 선택했을 경우(J)
                    addr = data.jibunAddress;
                }

                // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
               if(data.userSelectedType === 'R'){
                    // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                    // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                    if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                        extraAddr += data.bname;
                    }
                    // 건물명이 있고, 공동주택일 경우 추가한다.
                    if(data.buildingName !== '' && data.apartment === 'Y'){
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                    if(extraAddr !== ''){
                        extraAddr = ' (' + extraAddr + ')';
                    }
                    // 조합된 참고항목을 해당 필드에 넣는다.
                   // document.getElementById("sample6_extraAddress").value = extraAddr;

                } else {
                   // document.getElementById("sample6_extraAddress").value = '';
                }

                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById('sample6_postcode').value = data.zonecode;
                document.getElementById("sample6_address").value = addr;
                // 커서를 상세주소 필드로 이동한다.
                document.getElementById("sample6_detailAddress").focus();
            }
        }).open();
    }
</script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">주소등록</h1>
<form class="form-horizontal"
      action="createProc.jsp"
      method="post"
      >

  <div class="form-group">
    <label class="control-label col-sm-2" for="name">이름</label>
    <div class="col-sm-6">
      <input type="text" name="name" id="name" class="form-control">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="handphone">전화번호</label>
    <div class="col-sm-6">
      <input type="text" name="handphone" id="handphone" class="form-control">
    </div>
  </div>

   <div class="form-group">
    <label class="control-label col-sm-2" for="zipcode">우편번호</label>
    <div class="col-sm-2">
      	<input type="text" name="zipcode" class="form-control"
      	id="sample6_postcode" placeholder="우편번호" >
    </div>
    <div class='col-sm-4'>
    	<button class='btn' type="button" onclick="sample6_execDaumPostcode()">주소검색</button>
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="address">주소</label>
    <div class="col-sm-6">
    <input type="text" name="address" id="sample6_address" placeholder="주소" class="form-control" >
    </div>
  </div>
    <div class="form-group">
    <label class="control-label col-sm-2" for="address2">상세주소</label>
    <div class="col-sm-6">
    <input type="text" name="address2" id="sample6_detailAddress" placeholder="상세주소" class="form-control" >
    </div>
  </div>

   <div class="form-group">
   <div class="col-sm-offset-2 col-sm-5">
    <button class="btn">등록</button>
    <button type="reset" class="btn">취소</button>
   </div>
 </div>
</form>
</div>
</body>
</html>
```

주소 검색을 눌렀을 때 생성되는 팝업 만들기.

![image](https://user-images.githubusercontent.com/101780699/170220065-acfda9d2-d7cb-4622-b211-139dcc6629fb.png)

---

addr 폴더에 list.jsp 만들기

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>

<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script>
  function del(addressnum){
	  if(confirm("정말 삭제하시겠습니까?")){
	  	let url = "deleteProc.jsp?addressnum=" + addressnum;
	  	location.href=url;
	  }
  }
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">주소록</h1>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>이름</th>
			<th>전화번호</th>
			<th>주소</th>
			<th>삭제</th>
		</tr>
	</thead>
	<tbody>
		<tr>
		<td>1</td>
		<td>홍길동</td>
		<td>010-1111-1111</td>
		<td>서울시 강남구</td>
		<td><a href="javascript:del('1')">삭제</a></td>
		</tr>
				<tr>
		<td>2</td>
		<td>홍길동</td>
		<td>010-1111-1111</td>
		<td>서울시 강남구</td>
		<td><a href="javascript:deldel('2')">삭제</a></td>
		</tr>
				<tr>
		<td>3</td>
		<td>홍길동</td>
		<td>010-1111-1111</td>
		<td>서울시 강남구</td>
		<td><a href="javascript:deldel('3')">삭제</a></td>
		</tr>
				<tr>
		<td>4</td>
		<td>홍길동</td>
		<td>010-1111-1111</td>
		<td>서울시 강남구</td>
		<td><a href="javascript:deldel('4')">삭제</a></td>
		</tr>

	</tbody>
	</table>
</div>
</body>
</html>
```

삭제를 눌렀을 때 나오는 팝업 확인

![image](https://user-images.githubusercontent.com/101780699/170223320-fa216037-79d4-4977-afbc-0daf3759f163.png)
