(4) views/read.jsp 
\- Ajax테스트 위한 버튼 생성

read.jsp 수정 삭제2 버튼 추가

```jsp
<div>
        <button type="button" class="btn" onclick="location.href='./create'">등록</button>
        <button type="button" class="btn" onclick="updateM()">수정</button>
        <button type="button" class="btn" onclick="deleteM()">삭제</button>
        <button type="button" class="btn" onclick="replyM()">답변</button>
        <button type="button" class="btn" onclick="listM()">목록</button>
        <button type="button" class="btn" onclick="delete_Ajax()">삭제2</button>
</div>
```

read.jsp 수정 버튼 클릭 후 실행하는 javascript delete_Ajax() 추가

 ```java
    function delete_Ajax(){
        var url = "/bbs/delete_Ajax";
        url += "?bbsno=${dto.bbsno}";
        url += "&oldfile=${dto.filename}";
        //alert(url);    
        location.href=url;
      }
 ```

(5) tiles.xml 수정 delete_Ajax 추가

```xml
    <definition name="/bbs/delete_Ajax" extends="main"> 
        <put-attribute name="title" value="bbs Ajax 삭제" ></put-attribute> 
        <put-attribute name="body" value="/WEB-INF/views/delete_Ajax.jsp" /> 
    </definition> 
```



## [01] 파일 다운로드 구현
### 1. 목록, 조회 페이지에서 다운로드 링크 만들기

list.jsp 수정 파일없음 표시하기

```jsp

<c:choose>
    <c:when test="${empty dto.filename}">파일없음</c:when>
    <c:otherwise>
    <a href="javascript:fileDown('${dto.filename}')">
    ${dto.filename}
    </a>
    </c:otherwise>
    </c:choose>
```

![image](https://user-images.githubusercontent.com/101780699/173713144-b5573e46-b62e-421d-a4e2-5dc99517c102.png)



---



### 2. 다운로드 요청URL을 받는 Controller의 메소드 제작

list.jsp 수정 fileDown 추가

```jsp
  	function fileDown(filename){
        var url = "./fileDown";
        url += "?filename="+filename;
        location.href=url;
       }
```

BbsController.java 수정 fileDown 추가

```java
@GetMapping("/bbs/fileDown")
public void fileDown(HttpServletRequest request, HttpServletResponse response) throws IOException {
    
    // 저장 폴더를 절대 경로로 변환
            String dir= UploadBbs.getUploadDir();
            // 파일명 받기
            String filename = request.getParameter("filename");
            byte[] files = FileUtils.readFileToByteArray(new File(dir, filename));
            response.setHeader("Content-disposition",
                        "attachment; fileName=\"" + URLEncoder.encode(filename, "UTF-8") + "\";");
           // Content-Transfer-Encoding : 전송 데이타의 body를 인코딩한 방법을 표시함.
           response.setHeader("Content-Transfer-Encoding", "binary");
         /**
          * Content-Disposition가 attachment와 함게 설정되었다면 'Save As'로 파일을 제안하는지 여부에 따라 브라우저가
          * 실행한다.
          */
         response.setContentType("application/octet-stream");
         response.setContentLength(files.length);
         response.getOutputStream().write(files);
         response.getOutputStream().flush();
         response.getOutputStream().close();
        }
```



## [01] RestController를 이용한 댓글 목록
### 1. RestController
 \- REST는 Representational State Transfer의 약자로 하나의 URI는 하나의
  고유한 리소스(Resource)를 대표하도록 설계된다는 개념에 전송방식을
  결합해서 원하는 작업을 지정한다. 

 \- REST는 HTTP URI로 리소스를 정의하고 HTTP메소드로 리소스에 대한
  행위를 정의한다.
 \- 리소스는 JSON, XML과 같은 여러가지 언어로 표현할 수 있다.

 \- REST서비스에서는 CRUD에 해당하는 4개의 HTTP 메소드가 있다.

![image](https://user-images.githubusercontent.com/101780699/173717554-cd79b1d8-64f7-4298-83d4-c4d55cbef55c.png)

\- RestController는 기존 Controller 와 ResponseBody를 합친 모습과 같다.
\- RestController는 기존 Controller가 JSP경로를 리턴 했다면 RestController는 
 순수한 데이터를 반환한다.
\- 일반 문자열, JSON, XML등의 다양한 포맷의 데이터를 전송한다.
\- RestController에서 사용가능한 요청annotation
 @RequestMapping
 @GetMapping
 @PostMapping
 @PutMapping
 @DeleteMapping

(1) 라이브러리 추가

build.gradle

```java
// https://mvnrepository.com/artifact/org.json/json
    implementation group: 'org.json', name: 'json', version: '20201115'
```

### 2. 댓글 처리 구현 
 \- spring_bbs Project의 bbs내용보기에서 댓글 구현을 추가한다.
 \- 댓글은 답변하고 다르게 새로운 테이블을 생성한다.
 \- 댓글입력시 로그인 인증후 댓글 쓰기와 수정, 삭제가 가능하다.

(1) 댓글 테이블 설정

\>>> /sql/reply.sql

```sql
use webtest;
 
create table reply(
   rnum int not null auto_increment primary key,
   content varchar(500) not null,
   regdate date not null,
   id varchar(10) not null,
   bbsno int(7) not null,
   foreign key(bbsno) references bbs(bbsno)
);
 
select * from bbs;
 
insert into reply(content, regdate, id, bbsno)
values('의견입니다.',sysdate(),'user1',34);
 
 
-- list(목록)
select rnum, content, regdate, id, bbsno
from REPLY
where bbsno = 34
order by rnum DESC
limit 0, 3;
 
 
-- total(목록)
select count(*) from reply
where bbsno = 34;
```



(2) Model 생성 및 mybatis mapper xml 제작

model/ReplyDTO.java 생성

```java
package com.study.model;
 
public class ReplyDTO {
  private int rnum;
  private String content;
  private String regdate;
  private String id;
  private int bbsno;
 
  public int getRnum() {
    return rnum;
  }
 
  public void setRnum(int rnum) {
    this.rnum = rnum;
  }
 
  public String getContent() {
    return content;
  }
 
  public void setContent(String content) {
    this.content = content;
  }
 
  public String getRegdate() {
    return regdate;
  }
 
  public void setRegdate(String regdate) {
    this.regdate = regdate;
  }
 
  public String getId() {
    return id;
  }
 
  public void setId(String id) {
    this.id = id;
  }
 
  public int getBbsno() {
    return bbsno;
  }
 
  public void setBbsno(int bbsno) {
    this.bbsno = bbsno;
  }
}
```

 ReplyMapper.java 생성

```java
package com.study.model;
 
import java.util.List;
import java.util.Map;
 
public interface ReplyMapper{
 
   int create(ReplyDTO replyDTO);
 
   List<ReplyDTO> list(Map map);
 
   ReplyDTO read(int rnum);
  
   int update(ReplyDTO replyDTO); 
   
   int delete(int rnum);
 
   int total(int bbsno);
}
```

interface ReplyService.java 생성

```java
package com.study.model;

import java.util.List;
import java.util.Map;

public interface ReplyService {
    int create(ReplyDTO replyDTO);
  
    List<ReplyDTO> list(Map map);
  
    ReplyDTO read(int rnum);
   
    int update(ReplyDTO replyDTO); 
    
    int delete(int rnum);
  
    int total(int bbsno);
 }
```

 ReplyServiceImpl.java 생성 add ReplyService, @Service

```java
package com.study.model;

import java.util.List;
import java.util.Map;

import org.springframework.stereotype.Service;

@Service("com.study.model.ReplyServiceImpl")
public class ReplyServiceImpl implements ReplyService {

  @Override
  public int create(ReplyDTO replyDTO) {
    // TODO Auto-generated method stub
    return 0;
  }

  @Override
  public List<ReplyDTO> list(Map map) {
    // TODO Auto-generated method stub
    return null;
  }

  @Override
  public ReplyDTO read(int rnum) {
    // TODO Auto-generated method stub
    return null;
  }

  @Override
  public int update(ReplyDTO replyDTO) {
    // TODO Auto-generated method stub
    return 0;
  }

  @Override
  public int delete(int rnum) {
    // TODO Auto-generated method stub
    return 0;
  }

  @Override
  public int total(int bbsno) {
    // TODO Auto-generated method stub
    return 0;
  }

}

```

mybatis/reply.xml 생성

```xml
<?xml version="1.0" encoding="UTF-8" ?> 
 
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.study.model.ReplyMapper">
	<insert id="create" parameterType="com.study.model.ReplyDTO">
	
	</insert>
	<delete id="delete" parameterType="int">
	
	</delete>
	
	<select id="list" parameterType="Map" resultType="com.study.model.ReplyDTO">
		select rnum, content, regdate, id, bbsno
	    from REPLY
	    where bbsno = #{bbsno}
	    order by rnum DESC
	    limit #{sno}, #{eno}
	</select>
	
	<select id="read" parameterType="int" resultType="com.study.model.ReplyDTO">
	
	</select>
	
	<select id="total" parameterType="int" resultType="int" >
		select count(*) from reply
    	where bbsno = #{bbsno}
	</select>
	
	<update id="update" parameterType="com.study.model.ReplyDTO">
	
	</update>
</mapper>
```



(3) BbsController.java 수정
 \- 게시판 조회 아래부분에서 댓글의 목록을 출력하기 위한 내용을 작성한다.

BbsController.java 수정 read 수정

```java
 @GetMapping("/bbs/read/{bbsno}")
  public String read(@PathVariable int bbsno, Model model, HttpServletRequest request) {
    dao.upViewcnt(bbsno);
    model.addAttribute("dto", dao.read(bbsno));
    /* 댓글 관련 시작 */
    int nPage = 1;
    if (request.getParameter("nPage") != null) {
      nPage = Integer.parseInt(request.getParameter("nPage"));
    }
    int recordPerPage = 3;

    int sno = (nPage - 1) * recordPerPage;
    int eno = recordPerPage;

    Map map = new HashMap();
    map.put("sno", sno);
    map.put("eno", eno);
    map.put("nPage", nPage);

    model.addAllAttributes(map);

    /* 댓글 처리 끝 */
    return "/read";
  }
```



(4) views/bbs/read.jsp 댓글 목록 출력 추가
\- 조회 마지막부분, 버튼 이후에 작성한다.
\- 댓글의 모든 출력은 Bootstrap의 modal을 사용한다.

read.jsp 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %> 
<!DOCTYPE html> 
<html> 
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script>
  	function update(){ //수정페이지 이동
  		let url = '/bbs/update/${dto.bbsno}';
  		location.href = url;
  	}
  	
  	function del(){ //삭제페이지 이동
  		let url = '/bbs/delete/${dto.bbsno}';
  		url += '?oldfile=${dto.filename}'
  		location.href = url;
  	}
  	
  	function reply(){ //답변페이지 이동
  		let url = '/bbs/reply/${dto.bbsno}';
  		location.href = url;
  	}
  	
  	function delete_Ajax(){
  		var url = "/bbs/delete_Ajax";
        url += "?bbsno=${dto.bbsno}";
        url += "&oldfile=${dto.filename}";
        //alert(url);    
        location.href=url;
  	}
  	
  </script>
</head>
<body> 
<div class="container">
<h1>조회</h1>
<div class="panel panel-default">
	<div class="panel-heading">작성자</div>
	<div class="panel-body">${dto.wname}</div>
	<div class="panel-heading">제목</div>
	<div class="panel-body">${dto.title}</div>
	<div class="panel-heading">내용</div>
	<div class="panel-body" style='height:170px'>${dto.content}</div>
	<div class="panel-heading">조회수</div>
	<div class="panel-body">${dto.viewcnt}</div>
	<div class="panel-heading">등록일</div>
	<div class="panel-body">${dto.wdate}</div>
	<div class="panel-heading">파일명</div>
	<div class="panel-body">${dto.filename}</div>
</div>
<div>
	<button onclick="location.href='/bbs/create'">등록</button>
	<button onclick="update()">수정</button>
	<button onclick="del()">삭제</button>
	<button onclick="reply()">답변</button>	
	<button onclick="location.href='/bbs/list'">목록</button>
	<button onclick="delete_Ajax()">삭제2</button>
</div>
<br>
<div class='row'>
 
<div class="col-lg-12">
 
<!-- panel start-->
<div class="panel panel-default">
 
<div class="panel-heading">
        <i class="fa fa-comments fa-fw"></i> 댓글
        <button id='addReplyBtn' class='btn btn-primary btn-xs pull-right'>New
                Reply</button>
</div>
 
 
<div class="panel-body">
 
        <ul class="chat list-group">
                <li class="left clearfix" data-rno="12">
                        <div>
                                <div class="header">
                                        <strong class="primary-font">user1</strong> <small
                                                class="pull-right text-muted">2019-05-12</small>
                                </div>
                                <p>Good job!</p>
 
                        </div>
                </li>
        </ul>
        <!-- ul end  -->
</div>
 
<div class="panel-footer"></div>
 
</div>
<!-- panel end-->
</div>
<!--  col-lg-12 end -->
</div>
<!-- row end -->
</div>
</body> 
</html> 
```

![image](https://user-images.githubusercontent.com/101780699/173723737-86f8e50e-6022-468c-853d-1c7b337377d7.png)



---



list.jsp 수정 function read 수정

```jsp
	function read(bbsno) {
		let url = 'read/' + bbsno;//bbsno를 경로로 가져가는것
		url += "?nowPage=${nowPage}";
		url += "&col=${col}";
		url += "&word=${word}";
		location.href = url;
	}
```

read.jsp 수정 목록 버튼 수정

```jsp
<div>
	<button onclick="location.href='/bbs/create'">등록</button>
	<button onclick="update()">수정</button>
	<button onclick="del()">삭제</button>
	<button onclick="reply()">답변</button>	
	<button onclick="list()">목록</button>
	<button onclick="delete_Ajax()">삭제2</button>
</div>
```

read.jsp 수정 function list 추가

```jsp
  	function list(){
  		let url = '/bbs/list';
  		url += "?nowPage=${param.nowPage}";
  		url += "&col=${param.col}";
  		url += "&word=${param.word}";
  		location.href = url;
  	}
```

# ![image](https://user-images.githubusercontent.com/101780699/173733231-54716471-9899-4bab-b65c-0f3b8bb12869.png)



---



read.jsp 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %> 
<!DOCTYPE html> 
<html> 
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script>
  	function list(){
  		let url = '/bbs/list';
  		url += "?nowPage=${param.nowPage}";
  		url += "&col=${param.col}";
  		url += "&word=${param.word}";
  		location.href = url;
  	}
  	function update(){ //수정페이지 이동
  		let url = '/bbs/update/${dto.bbsno}';
  		location.href = url;
  	}
  	
  	function del(){ //삭제페이지 이동
  		let url = '/bbs/delete/${dto.bbsno}';
  		url += '?oldfile=${dto.filename}'
  		location.href = url;
  	}
  	
  	function reply(){ //답변페이지 이동
  		let url = '/bbs/reply/${dto.bbsno}';
  		location.href = url;
  	}
  	
  	function delete_Ajax(){
  		var url = "/bbs/delete_Ajax";
        url += "?bbsno=${dto.bbsno}";
        url += "&oldfile=${dto.filename}";
        //alert(url);    
        location.href=url;
  	}
  	
  </script>
</head>
<body> 
<div class="container">
<h1>조회</h1>
<div class="panel panel-default">
	<div class="panel-heading">작성자</div>
	<div class="panel-body">${dto.wname}</div>
	<div class="panel-heading">제목</div>
	<div class="panel-body">${dto.title}</div>
	<div class="panel-heading">내용</div>
	<div class="panel-body" style='height:170px'>${dto.content}</div>
	<div class="panel-heading">조회수</div>
	<div class="panel-body">${dto.viewcnt}</div>
	<div class="panel-heading">등록일</div>
	<div class="panel-body">${dto.wdate}</div>
	<div class="panel-heading">파일명</div>
	<div class="panel-body">${dto.filename}</div>
</div>
<div>
	<button onclick="location.href='/bbs/create'">등록</button>
	<button onclick="update()">수정</button>
	<button onclick="del()">삭제</button>
	<button onclick="reply()">답변</button>	
	<button onclick="list()">목록</button>
	<button onclick="delete_Ajax()">삭제2</button>
</div>
<br>
<div class='row'>
 
<div class="col-lg-12">
 
<!-- panel start-->
<div class="panel panel-default">
 
<div class="panel-heading">
        <i class="fa fa-comments fa-fw"></i> 댓글
        <button id='addReplyBtn' class='btn btn-primary btn-xs pull-right'>New
                Reply</button>
</div>
 
 
<div class="panel-body">
 
        <ul class="chat list-group">
                <li class="left clearfix" data-rno="12">
                        <div>
                                <div class="header">
                                        <strong class="primary-font">user1</strong> <small
                                                class="pull-right text-muted">2019-05-12</small>
                                </div>
                                <p>Good job!</p>
 
                        </div>
                </li>
        </ul>
        <!-- ul end  -->
</div>
 
<div class="panel-footer"></div>
 
</div>
<!-- panel end-->
</div>
<!--  col-lg-12 end -->
</div>
<!-- row end -->
</div>
 <!-- 페이지 로딩시 댓글 목록 처리-->
 <!-- jstl는 internal javascript에서 사용가능 -->
 <script>
  let bbsno = "${dto.bbsno}"; 
  let sno = "${sno}";
  let eno = "${eno}";
 <!-- 댓글용 paging, 게시판 검색 -->
  let nPage = "${nPage}";
  let nowPage = "${param.nowPage}";
  let colx = "${param.col}";
  let wordx = "${param.word}";
 </script>
  <!-- 댓글처리 관련 Javascript 파일 추가-->
<script src="/js/producer.js"></script>
 
<script src="/js/consumer.js"></script>
</body> 
</html> 
```





(5) 댓글처리 Ajax javascript 

\- static/js폴더 생성후 javascript파일 생성
\- js/replyprocess.js 는 페이지 로딩되면서 댓글목록을 처리할 함수 호출한다.
\- js/breply.js 는 댓글 목록처리를 위한 함수들이 정의 되어 있다.

resource/static/js 폴더 추가

js/producer.js 추가

```js
console.log("*****Reply Module........");
function getList(param) {
     let bbsno = param.bbsno;
         let sno = param.sno;
         let eno = param.eno;
        return fetch(`/bbs/reply/list/${bbsno}/${sno}/${eno}`,{method:'get'}) 
              .then(response => response.json())
              .catch(console.log)
}
 
function getPage(param) {
    let url = `/bbs/reply/page?${param}`;
console.log(url);
        return fetch(url,{method : 'get'})
              .then(response => response.text())
              .catch(console.log)
 
}
```

js/consumer.js 추가

```js
$(function () {//페이지가 로딩될때
   showList();
   showPage();
});//page loading function end  
 
let replyUL = $(".chat");
let replyPageFooter = $(".panel-footer");
 
function showList() {
    getList({ bbsno: bbsno, sno: sno, eno: eno })
    .then(list => {
      let str = ""
 
      for (var i = 0; i < list.length ; i++) {
        str += "<li class='list-group-item' data-rnum='" + list[i].rnum + "'>";
        str += "<div><div class='header'><strong class='primary-font'>" + list[i].id + "</strong>";
        str += "<small class='pull-right text-muted'>" + list[i].regdate + "</small></div>";
        str += replaceAll(list[i].content, '\n', '<br>') + "</div></li>";
      }
 
      replyUL.html(str);
    });
 
}//showList() end
 
function replaceAll(str, searchStr, replaceStr) {
  return str.split(searchStr).join(replaceStr);
}
 
let param = '';
    param = "nPage=" + nPage;
    param += "&nowPage=" + nowPage;
    param += "&bbsno=" + bbsno;
    param += "&col=" + colx;
    param += "&word=" + wordx;
 
function showPage(){
    getPage(param)
    .then(paging => {
      console.log(paging);
      let str = "<div><small class='text-muted'>" + paging + "</small></div>";
 
      replyPageFooter.html(str);
});
}
```



---



### 3. Ajax 요청을 처리하는 RestController 작성

controller/ReplyController.java

```java
package com.study.controller;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;

import com.study.model.ReplyDTO;
import com.study.model.ReplyService;
import com.study.utility.Utility;

@RestController
public class ReplyController {
  
  private static final Logger log = LoggerFactory.getLogger(ReplyController.class);
//ReplyController 부분만 변경해서 다른 부트사용하는 파일에서 사용가능

  @Autowired
  @Qualifier("com.study.model.ReplyServiceImpl")
  private ReplyService service;
  
  @GetMapping("/bbs/reply/list/{bbsno}/{sno}/{eno}")
  public ResponseEntity<List<ReplyDTO>> getList(
      @PathVariable("bbsno") int bbsno, 
      @PathVariable("sno") int sno,
      @PathVariable("eno") int eno) {
 
    Map map = new HashMap();
    map.put("sno", sno);
    map.put("eno", eno);
    map.put("bbsno", bbsno);
 
    return new ResponseEntity<List<ReplyDTO>>(service.list(map), HttpStatus.OK);
  }
  
  @GetMapping("/bbs/reply/page")
  public ResponseEntity<String> getPage(
     int nPage, int nowPage,int bbsno, String col, String word) {
 
    int total = service.total(bbsno);
    String url = "/bbs/read/"+bbsno;
 
    int recordPerPage = 3; // 한페이지당 출력할 레코드 갯수
 
    String paging = Utility.rpaging(total, nowPage, recordPerPage, col, word, url, nPage);
 
    return new ResponseEntity<>(paging, HttpStatus.OK);
 
  }
  
}
```



### 4. 댓글목록 페이징
\- Utility.java 에 rpaging 메소드추가

Utility.java 수정 추가

```java
package com.study.utility;

import java.io.File;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.io.OutputStream;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.List;

import org.springframework.web.multipart.MultipartFile;

public class Utility {

  /**
   * 오늘,어제,그제 날짜 가져오기
   * 
   * @return List- 날짜들 저장 SimpleDateFormat("yyyy-MM-dd")
   */
  public static List<String> getDay() {
    List<String> list = new ArrayList<String>();

    SimpleDateFormat sd = new SimpleDateFormat("yyyy-MM-dd");
    Calendar cal = Calendar.getInstance();
    for (int j = 0; j < 3; j++) {
      list.add(sd.format(cal.getTime()));
      cal.add(Calendar.DATE, -1);
    }

    return list;
  }

  /**
   * 등록날짜와 오늘,어제,그제날짜와 비교
   * 
   * @param wdate - 등록날짜
   * @return - true:오늘,어제,그제중 등록날짜와 같음 false:오늘,어제,그제 날짜가 등록날짜와 다 다름
   */
  public static boolean compareDay(String wdate) {
    boolean flag = false;
    List<String> list = getDay();
    if (wdate.equals(list.get(0)) || wdate.equals(list.get(1)) || wdate.equals(list.get(2))) {
      flag = true;
    }

    return flag;
  }

  public static String checkNull(String str) {
    if (str == null) {
      str = "";
    }
    return str;
  }

  /**
   * @param totalRecord   전체 레코드수
   * @param nowPage       현재 페이지
   * @param recordPerPage 페이지당 레코드 수
   * @param col           검색 컬럼
   * @param word          검색어
   * @return 페이징 생성 문자열
   */
  public static String paging(int totalRecord, int nowPage, int recordPerPage, String col, String word) {
    int pagePerBlock = 5; // 블럭당 페이지 수
    int totalPage = (int) (Math.ceil((double) totalRecord / recordPerPage)); // 전체 페이지
    int totalGrp = (int) (Math.ceil((double) totalPage / pagePerBlock));// 전체 그룹
    int nowGrp = (int) (Math.ceil((double) nowPage / pagePerBlock)); // 현재 그룹
    int startPage = ((nowGrp - 1) * pagePerBlock) + 1; // 특정 그룹의 페이지 목록 시작
    int endPage = (nowGrp * pagePerBlock); // 특정 그룹의 페이지 목록 종료

    StringBuffer str = new StringBuffer();
    str.append("<div style='text-align:center'>");
    str.append("<ul class='pagination'> ");
    int _nowPage = (nowGrp - 1) * pagePerBlock; // 10개 이전 페이지로 이동
    if (nowGrp >= 2) {
      str.append("<li><a href='./list?col=" + col + "&word=" + word + "&nowPage=" + _nowPage + "'>이전</A></li>");
    }

    for (int i = startPage; i <= endPage; i++) {
      if (i > totalPage) {
        break;
      }

      if (nowPage == i) {
        str.append("<li class='active'><a href=#>" + i + "</a></li>");
      } else {
        str.append("<li><a href='./list?col=" + col + "&word=" + word + "&nowPage=" + i + "'>" + i + "</A></li>");
      }
    }

    _nowPage = (nowGrp * pagePerBlock) + 1; // 10개 다음 페이지로 이동
    if (nowGrp < totalGrp) {
      str.append("<li><A href='./list?col=" + col + "&word=" + word + "&nowPage=" + _nowPage + "'>다음</A></li>");
    }
    str.append("</ul>");
    str.append("</div>");

    return str.toString();
  }

  public static String saveFileSpring(MultipartFile mf, String basePath) {
    InputStream inputStream = null;
    OutputStream outputStream = null;
    String filename = "";
    long filesize = mf.getSize();
    String originalFilename = mf.getOriginalFilename();
    try {
      if (filesize > 0) { // 파일이 존재한다면
        // 인풋 스트림을 얻는다.
        inputStream = mf.getInputStream();

        File oldfile = new File(basePath, originalFilename);

        if (oldfile.exists()) {
          for (int k = 0; true; k++) {
            // 파일명 중복을 피하기 위한 일련 번호를 생성하여
            // 파일명으로 조합
            oldfile = new File(basePath, "(" + k + ")" + originalFilename);

            // 조합된 파일명이 존재하지 않는다면, 일련번호가
            // 붙은 파일명 다시 생성
            if (!oldfile.exists()) { // 존재하지 않는 경우
              filename = "(" + k + ")" + originalFilename;
              break;
            }
          }
        } else {
          filename = originalFilename;
        }
        String os = System.getProperty("os.name").toLowerCase();
        System.out.println("os: " + os); // windows 10, linux, mac os x
        String serverFullPath = null;
        if (os.equals("mac os x")) { // Mac
          System.out.println("맥");
          serverFullPath = basePath + "/" + filename;
        } else if (os.equals("windows 11")) {//운영체제 반드시 고쳐주어야함 10이면 10 11이면 11
          System.out.println("os: " + os);
          serverFullPath = basePath + "\\" + filename;
        } else if (os.equals("linux")) {
          System.out.println("리눅스");
          serverFullPath = basePath + "/" + filename;
        }

        System.out.println("fileName: " + filename);
        System.out.println("serverFullPath: " + serverFullPath);

        outputStream = new FileOutputStream(serverFullPath);

        // 버퍼를 만든다.
        int readBytes = 0;
        byte[] buffer = new byte[8192];

        while ((readBytes = inputStream.read(buffer, 0, 8192)) != -1) {
          outputStream.write(buffer, 0, readBytes);
        }
        outputStream.close();
        inputStream.close();

      }

    } catch (Exception e) {
      e.printStackTrace();
    } finally {

    }

    return filename;
  }

  public static void deleteFile(String upDir, String oldfile) {
    File file = new File(upDir, oldfile);
    if (file.exists())
      file.delete();

  }

  public static String rpaging(int total, int nowPage, int recordPerPage, String col, String word, String url,
      int nPage) {
    int pagePerBlock = 5; // 블럭당 페이지 수
    int totalPage = (int) (Math.ceil((double) total / recordPerPage)); // 전체 페이지
    int totalGrp = (int) (Math.ceil((double) totalPage / pagePerBlock));// 전체 그룹
    int nowGrp = (int) (Math.ceil((double) nPage / pagePerBlock)); // 현재 그룹
    int startPage = ((nowGrp - 1) * pagePerBlock) + 1; // 특정 그룹의 페이지 목록 시작
    int endPage = (nowGrp * pagePerBlock); // 특정 그룹의 페이지 목록 종료
 
    StringBuffer str = new StringBuffer();
    str.append("<div style='text-align:center'>");
    str.append("<ul class='pagination'> ");
    int _nowPage = (nowGrp - 1) * pagePerBlock; // 10개 이전 페이지로 이동
 
    if (nowGrp >= 2) {
      str.append("<li><a href='" + url + "?col=" + col + "&word=" + word + "&nowPage=" + nowPage + "&bbsno="
          + "&nPage=" + _nowPage + "'>이전</A></li>");
    }
 
    for (int i = startPage; i <= endPage; i++) {
      if (i > totalPage) {
        break;
      }
 
      if (nPage == i) {
        str.append("<li class='active'><a href=#>" + i + "</a></li>");
      } else {
        str.append("<li><a href='" + url + "?col=" + col + "&word=" + word + "&nowPage=" + nowPage + "&bbsno="
            + "&nPage=" + i + "'>" + i + "</A></li>");
      }
    }
 
    _nowPage = (nowGrp * pagePerBlock) + 1; // 10개 다음 페이지로 이동
    if (nowGrp < totalGrp) {
      str.append("<li><A href='" + url + "?col=" + col + "&word=" + word + "&nowPage=" + nowPage + "&bbsno="
          + "&nPage=" + _nowPage + "'>다음</A></li>");
    }
    str.append("</ul>");
    str.append("</div>");
 
    return str.toString();
 
  }
}

```



ReplyServiceImpl.java 수정 list total 추가

```java
package com.study.model;

import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service("com.study.model.ReplyServiceImpl")
public class ReplyServiceImpl implements ReplyService {

  @Autowired
  private ReplyMapper mapper;
  
  @Override
  public int create(ReplyDTO replyDTO) {
    // TODO Auto-generated method stub
    return 0;
  }

  @Override
  public List<ReplyDTO> list(Map map) {
    // TODO Auto-generated method stub
    return mapper.list(map);
  }

  @Override
  public ReplyDTO read(int rnum) {
    // TODO Auto-generated method stub
    return null;
  }

  @Override
  public int update(ReplyDTO replyDTO) {
    // TODO Auto-generated method stub
    return 0;
  }

  @Override
  public int delete(int rnum) {
    // TODO Auto-generated method stub
    return 0;
  }

  @Override
  public int total(int bbsno) {
    // TODO Auto-generated method stub
    return mapper.total(bbsno);
  }

}

```







---

---



## [01]RestController를 이용한 댓글 생성,조회

\- 댓글 등록은 회원 로그인 후 사용한다. 회원가입 및 로그인 처리는 나중에
 제작하고 댓글 처리 수정 예정이다
\- insert 에서 댓글 등록한 id와 댓글이 등록될 글번호(bbsno)에 존재하는 값이
 들어가야 한다.



reply.xml 수정 create, read 추가

```xml
<?xml version="1.0" encoding="UTF-8" ?> 
 
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.study.model.ReplyMapper">
	<insert id="create" parameterType="com.study.model.ReplyDTO">
    insert into reply(content, regdate, id, bbsno)
    values(#{content}, sysdate(), #{id}, #{bbsno}) 
	</insert>
	<delete id="delete" parameterType="int">
	
	</delete>
	
	<select id="list" parameterType="Map" resultType="com.study.model.ReplyDTO">
		select rnum, content, regdate, id, bbsno
	    from REPLY
	    where bbsno = #{bbsno}
	    order by rnum DESC
	    limit #{sno}, #{eno}
	</select>
	
	<select id="read" parameterType="int" resultType="com.study.model.ReplyDTO">
		   select * from reply
    where rnum = #{rnum}
	</select>
	
	<select id="total" parameterType="int" resultType="int" >
		select count(*) from reply
    	where bbsno = #{bbsno}
	</select>
	
	<update id="update" parameterType="com.study.model.ReplyDTO">
	
	</update>
</mapper>
```

ReplyServiceImpl.java 수정 create, read 추가

```java
package com.study.model;

import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service("com.study.model.ReplyServiceImpl")
public class ReplyServiceImpl implements ReplyService {

  @Autowired
  private ReplyMapper mapper;
  
  @Override
  public int create(ReplyDTO replyDTO) {
    // TODO Auto-generated method stub
    return mapper.create(replyDTO);
  }

  @Override
  public List<ReplyDTO> list(Map map) {
    // TODO Auto-generated method stub
    return mapper.list(map);
  }

  @Override
  public ReplyDTO read(int rnum) {
    // TODO Auto-generated method stub
    return mapper.read(rnum);
  }

  @Override
  public int update(ReplyDTO replyDTO) {
    // TODO Auto-generated method stub
    return 0;
  }

  @Override
  public int delete(int rnum) {
    // TODO Auto-generated method stub
    return 0;
  }

  @Override
  public int total(int bbsno) {
    // TODO Auto-generated method stub
    return mapper.total(bbsno);
  }

}

```



### 3. views/bbs/read.jsp에 modal 생성 및 자바스크립트 작성

read.jsp 수정  modal 추가

```jsp
<%@ page contentType="text/html; charset=UTF-8" %> 
<!DOCTYPE html> 
<html> 
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script>
  	function list(){
  		let url = '/bbs/list';
  		url += "?nowPage=${param.nowPage}";
  		url += "&col=${param.col}";
  		url += "&word=${param.word}";
  		location.href = url;
  	}
  	function update(){ //수정페이지 이동
  		let url = '/bbs/update/${dto.bbsno}';
  		location.href = url;
  	}
  	
  	function del(){ //삭제페이지 이동
  		let url = '/bbs/delete/${dto.bbsno}';
  		url += '?oldfile=${dto.filename}'
  		location.href = url;
  	}
  	
  	function reply(){ //답변페이지 이동
  		let url = '/bbs/reply/${dto.bbsno}';
  		location.href = url;
  	}
  	
  	function delete_Ajax(){
  		var url = "/bbs/delete_Ajax";
        url += "?bbsno=${dto.bbsno}";
        url += "&oldfile=${dto.filename}";
        //alert(url);    
        location.href=url;
  	}
  	
  </script>
</head>
<body> 
<div class="container">
<h1>조회</h1>
<div class="panel panel-default">
	<div class="panel-heading">작성자</div>
	<div class="panel-body">${dto.wname}</div>
	<div class="panel-heading">제목</div>
	<div class="panel-body">${dto.title}</div>
	<div class="panel-heading">내용</div>
	<div class="panel-body" style='height:170px'>${dto.content}</div>
	<div class="panel-heading">조회수</div>
	<div class="panel-body">${dto.viewcnt}</div>
	<div class="panel-heading">등록일</div>
	<div class="panel-body">${dto.wdate}</div>
	<div class="panel-heading">파일명</div>
	<div class="panel-body">${dto.filename}</div>
</div>
<div>
	<button onclick="location.href='/bbs/create'">등록</button>
	<button onclick="update()">수정</button>
	<button onclick="del()">삭제</button>
	<button onclick="reply()">답변</button>	
	<button onclick="list()">목록</button>
	<button onclick="delete_Ajax()">삭제2</button>
</div>
<br>
<div class='row'>
 
<div class="col-lg-12">
 
<!-- panel start-->
<div class="panel panel-default">
 
<div class="panel-heading">
        <i class="fa fa-comments fa-fw"></i> 댓글
        <button id='addReplyBtn' class='btn btn-primary btn-xs pull-right'>New
                Reply</button>
</div>
 
 
<div class="panel-body">
 
        <ul class="chat list-group">
                <li class="left clearfix" data-rno="12">
                        <div>
                                <div class="header">
                                        <strong class="primary-font">user1</strong> <small
                                                class="pull-right text-muted">2019-05-12</small>
                                </div>
                                <p>Good job!</p>
 
                        </div>
                </li>
        </ul>
        <!-- ul end  -->
</div>
 
<div class="panel-footer"></div>
 
</div>
<!-- panel end-->
</div>
<!--  col-lg-12 end -->
</div>
<!-- row end -->
</div>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-dialog">
  <div class="modal-content">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal"
        aria-hidden="true">&times;</button>
      <h4 class="modal-title" id="myModalLabel">REPLY MODAL</h4>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>내용</label> 
        <textarea cols="10" rows="3" class="form-control" name='content'>New Reply!!!!</textarea> 
      </div>      
    </div>
<div class="modal-footer">
<button id='modalModBtn' type="button" class="btn btn-warning">Modify</button>
<button id='modalRemoveBtn' type="button" class="btn btn-danger">Remove</button>
<button id='modalRegisterBtn' type="button" class="btn btn-primary">Register</button>
<button id='modalCloseBtn' type="button" class="btn btn-default">Close</button>
</div>          </div>
  <!-- /.modal-content -->
</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->
 <!-- 페이지 로딩시 댓글 목록 처리-->
 <!-- jstl는 internal javascript에서 사용가능 -->
 <script>
  let bbsno = "${dto.bbsno}"; 
  let sno = "${sno}";
  let eno = "${eno}";
 <!-- 댓글용 paging, 게시판 검색 -->
  let nPage = "${nPage}";
  let nowPage = "${param.nowPage}";
  let colx = "${param.col}";
  let wordx = "${param.word}";
 </script>
  <!-- 댓글처리 관련 Javascript 파일 추가-->
<script src="/js/producer.js"></script>
 
<script src="/js/consumer.js"></script>
</body> 
</html> 
```



producer.js 수정  reply, rnum 추가

```js
console.log("*****Reply Module........");
function getList(param) {
     let bbsno = param.bbsno;
         let sno = param.sno;
         let eno = param.eno;
        return fetch(`/bbs/reply/list/${bbsno}/${sno}/${eno}`,{method:'get'}) 
              .then(response => response.json())
              .catch(console.log)
}
 
function getPage(param) {
    let url = `/bbs/reply/page?${param}`;
console.log(url);
        return fetch(url,{method : 'get'})
              .then(response => response.text())
              .catch(console.log)
 
}

function add(reply) {
        return fetch('/reply/create',{
                method: 'post',
                body: JSON.stringify(reply),
                headers: {'Content-Type': "application/json; charset=utf-8"}
                })
                .then(response => response.json())
                .catch(console.log);
}
 
function get(rnum) {
        return fetch(`/reply/${rnum}`,{method: 'get'})
               .then(response => response.json())
               .catch(console.log);
}
```



js/consumer.js 수정 modal을 통한 댓글 이벤트 처리코드 추가

```js
let modal = $(".modal");
let modalInputContent = modal.find("textarea[name='content']");
 
let modalModBtn = $("#modalModBtn");
let modalRemoveBtn = $("#modalRemoveBtn");
let modalRegisterBtn = $("#modalRegisterBtn");
 
$("#modalCloseBtn").on("click", function (e) {
   modal.modal('hide');
});
  
$("#addReplyBtn").on("click", function (e) {
  modalInputContent.val("");
  modal.find("button[id !='modalCloseBtn']").hide();
 
  modalRegisterBtn.show();
 
  $(".modal").modal("show");
 
});
 
modalRegisterBtn.on("click", function (e) {
 
  if (modalInputContent.val() == '') {
    alert("댓글을 입력하세요")
    return;
  }
 
  let reply = {
    content: modalInputContent.val(),
    id: 'user1',
    bbsno: bbsno
  };
  add(reply)
    .then(result => {
      modal.find("input").val("");
      modal.modal("hide");
 
      showList();
      showPage();
 
    }); //end add
 
}); //end modalRegisterBtn.on
 
//댓글 조회 클릭 이벤트 처리 
$(".chat").on("click", "li", function (e) {
 
  let rnum = $(this).data("rnum");
 
   get(rnum)
    .then(reply => {
 
      modalInputContent.val(reply.content);
      modal.data("rnum", reply.rnum);
 
      modal.find("button[id !='modalCloseBtn']").hide();
 
      modalModBtn.show();
      modalRemoveBtn.show();
 
      $(".modal").modal("show");
 
    });
});

```



### 4. RestController 작성
ReplyController.java 수정 create, reply 추가

```java
 @PostMapping("/bbs/reply/create")
  public ResponseEntity<String> create(@RequestBody ReplyDTO vo) {
 
    log.info("ReplyDTO1: " + vo.getContent());
    log.info("ReplyDTO1: " + vo.getId());
    log.info("ReplyDTO1: " + vo.getBbsno());
 
    vo.setContent(vo.getContent().replaceAll("/n/r", "<br>"));
 
    int flag = service.create(vo);
 
    log.info("Reply INSERT flag: " + flag);
 
    return flag == 1 ? new ResponseEntity<>("success", HttpStatus.OK)
        : new ResponseEntity<>(HttpStatus.INTERNAL_SERVER_ERROR);
  }
 
  @GetMapping("/reply/{rnum}")
  public ResponseEntity<ReplyDTO> get(@PathVariable("rnum") int rnum) {
 
    log.info("get: " + rnum);
 
    return new ResponseEntity<>(service.read(rnum), HttpStatus.OK);
  }
```



![image](https://user-images.githubusercontent.com/101780699/173745852-33443b04-f05e-47da-9e41-7f349176968e.png)

![image](https://user-images.githubusercontent.com/101780699/173746304-fd68d0d1-692f-4cbb-9506-42c07637d610.png)

![image](https://user-images.githubusercontent.com/101780699/173750100-551c3c4b-5ef7-4c6c-83da-a6ef0644bd92.png)





---

---



## [01]RestController를 이용한 댓글 수정,삭제

### 1. SQL 

--update(댓글 수정)

update reply

set content = '새로운 의견을 올립니다.'

where rnum = 1;

 

--delete(댓글 삭제)

delete from REPLY

where rnum = 1;



### 2. mybatis xml mapper 제작

reply.xml 수정 update, delete 추가

```xml
<?xml version="1.0" encoding="UTF-8" ?> 
 
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.study.model.ReplyMapper">
	<insert id="create" parameterType="com.study.model.ReplyDTO">
    insert into reply(content, regdate, id, bbsno)
    values(#{content}, sysdate(), #{id}, #{bbsno}) 
	</insert>
	<delete id="delete" parameterType="int">
		delete from REPLY
		where rnum = #{rnum}
	</delete>
	
	<select id="list" parameterType="Map" resultType="com.study.model.ReplyDTO">
		select rnum, content, regdate, id, bbsno
	    from REPLY
	    where bbsno = #{bbsno}
	    order by rnum DESC
	    limit #{sno}, #{eno}
	</select>
	
	<select id="read" parameterType="int" resultType="com.study.model.ReplyDTO">
		   select * from reply
    	   where rnum = #{rnum}
	</select>
	
	<select id="total" parameterType="int" resultType="int" >
		select count(*) from reply
    	where bbsno = #{bbsno}
	</select>
	
	<update id="update" parameterType="com.study.model.ReplyDTO">
		update reply
		set content = #{content}
		where rnum = #{rnum}
	</update>
</mapper>
```

ReplyServiceImpl.java 수정 update, delete 추가

```java
package com.study.model;

import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service("com.study.model.ReplyServiceImpl")
public class ReplyServiceImpl implements ReplyService {

  @Autowired
  private ReplyMapper mapper;
  
  @Override
  public int create(ReplyDTO replyDTO) {
    // TODO Auto-generated method stub
    return mapper.create(replyDTO);
  }

  @Override
  public List<ReplyDTO> list(Map map) {
    // TODO Auto-generated method stub
    return mapper.list(map);
  }

  @Override
  public ReplyDTO read(int rnum) {
    // TODO Auto-generated method stub
    return mapper.read(rnum);
  }

  @Override
  public int update(ReplyDTO replyDTO) {
    // TODO Auto-generated method stub
    return mapper.update(replyDTO);
  }

  @Override
  public int delete(int rnum) {
    // TODO Auto-generated method stub
    return mapper.delete(rnum);
  }

  @Override
  public int total(int bbsno) {
    // TODO Auto-generated method stub
    return mapper.total(bbsno);
  }

}

```



### 3. views/bbs/read.jsp에서 사용하는 자바스크립트 작성

producer.js 수정 function update/remove 추가

```js
function update(reply) {
        return fetch(`/reply/`,{
                method: 'put',
                body: JSON.stringify(reply),
                headers: {'Content-Type': "application/json; charset=utf-8"}
                })
               .then(response => response.text())
               .catch(console.log);
}
 
function remove(rnum) {
        return fetch(`/reply/${rnum}`,{method: 'delete'})
               .then(response => response.text())
               .catch(console.log);
}
```

consumer.js 수정 댓글 수정, 삭제 추가

```js
 //댓글 수정
modalModBtn.on("click", function (e) {
 
  let reply = { rnum: modal.data("rnum"), content: modalInputContent.val() };
  update(reply)
    .then(result => {
      modal.modal("hide");
      showList();
      showPage();
    });
 
});//modify
 
//댓글 삭제
modalRemoveBtn.on("click", function (e) {
 
  let rnum = modal.data("rnum"); 
  remove(rnum)
    .then(result => {
      modal.modal("hide");
      showList();
      showPage();
    });
 
});//remove
```



### 4. RestController 작성

ReplyController.java 수정  @PutMapping, @DeleteMapping추가

```java
  @PutMapping("/reply/")
  public ResponseEntity<String> modify(@RequestBody ReplyDTO vo) {
 
    log.info("modify: " + vo);
 
    return service.update(vo) == 1 ? new ResponseEntity<>("success", HttpStatus.OK)
        : new ResponseEntity<>(HttpStatus.INTERNAL_SERVER_ERROR);
 
  }
 
  @DeleteMapping("/reply/{rnum}")
  public ResponseEntity<String> remove(@PathVariable("rnum") int rnum) {
 
    log.info("remove: " + rnum);
 
    return service.delete(rnum) == 1 ? new ResponseEntity<>("success", HttpStatus.OK)
        : new ResponseEntity<>(HttpStatus.INTERNAL_SERVER_ERROR);
 
  }
```

![image](https://user-images.githubusercontent.com/101780699/173761470-aadb7dfc-3215-4f5d-a9c6-c6e1fedc5ea3.png)

![image](https://user-images.githubusercontent.com/101780699/173762308-89fab6af-b6c2-4150-a01e-8fec9d8cfbf1.png)





---

---





## [01] 댓글 갯수 구현



BbsController.java 수정  ReplyService rservice 추가, nowPage -> rservice 변경

```java
  @Autowired
  @Qualifier("com.study.model.ReplyServiceImpl")
  public ReplyService rservice;

    List<BbsDTO> list = dao.list(map);
    int total = dao.total(map);
    String paging = Utility.paging(total, nowPage, recordPerPage, col, word);
    // 2.request 저장 (view페이지에서 사용할 내용을 저장)
    request.setAttribute("list", list);
    request.setAttribute("paging", paging);
    request.setAttribute("col", col);
    request.setAttribute("word", word);
    request.setAttribute("rservice", rservice);

    return "/list";
  }
```

Utility.java 수정 rcount 추가

```java
  public static int rcount(int bbsno,ReplyService rservice){
    return rservice.total(bbsno);
}
```



jstl/tlds -> spring_bbs 붙여넣기

el-function.tld 수정

```java
<?xml version="1.0" encoding="UTF-8" ?> 

<taglib xmlns="http://java.sun.com/xml/ns/j2ee" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee 
                        web-jsptaglibrary_2_0.xsd" 
    version="2.0"> 
     
    <description>EL에서 함수실행</description> 
    <tlib-version>1.0</tlib-version> 
    <uri>/ELFunctions</uri> 
   	<function>  
        <description>댓글 수 출력</description> 
        <name>rcount</name>  
        <function-class>
            com.study.utility.Utility
        </function-class>
        <function-signature> 
           int rcount( int, com.study.model.ReplyService ) 
        </function-signature> 
    </function> 
    
</taglib>
```



list.jsp 수정 태그 추가, 

```jsp
<%@ page contentType="text/html; charset=UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="util" uri="/ELFunctions"%>
<!DOCTYPE html>
<html>
<head>
<title>homepage</title>
<meta charset="utf-8">
<script type="text/javascript">
	function read(bbsno) {
		let url = 'read/' + bbsno;//bbsno를 경로로 가져가는것
		url += "?nowPage=${nowPage}";
		url += "&col=${col}";
		url += "&word=${word}";
		location.href = url;
	}

	function fileDown(filename) {
		var url = "./fileDown";
		url += "?filename=" + filename;
		location.href = url;
	}
</script>
</head>
<body>
	<div class="container">
		<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
		<form action="list" class='form-inline'>
			<div class='form-group'>
				<select class='form-control' name='col'>
					<option value="wname"
						<c:if test="${col == 'wname' }">selected</c:if>>성명</option>

					<option value="title"
						<c:if test="${col == 'title' }">selected</c:if>>제목</option>

					<option value="content"
						<c:if test="${col == 'content' }">selected</c:if>>내용</option>

					<option value="title_content"
						<c:if test="${col == 'title_content' }">selected</c:if>>제목+내용</option>

					<option value="total"
						<c:if test="${col == 'total' }">selected</c:if>>전체출력</option>

				</select>
			</div>
			<div class="form-group">
				<input type='text' class='form-control' placeholder='Enter 검색어'
					name='word' value="${word}">
			</div>
			<button class='btn btn-default'>검색</button>
			<button class='btn btn-default' type='button'
				onclick="location.href='create'">등록</button>
		</form>
		<table class="table table-striped">
			<thead>
				<tr>
					<th>번호</th>
					<th>제목</th>
					<th>작성자</th>
					<th>등록날짜</th>
					<th>조회수</th>
					<th>파일명</th>

				</tr>
			</thead>
			<tbody>

	<c:choose>
		<c:when test="${empty list}">

			<tr>
				<td colspan='6'>등록된 글이 없습니다.</td>
			</tr>

		</c:when>

		<c:otherwise>

			<c:forEach var="dto" items="${list}">

				<tr>
					<td>${dto.bbsno}</td>
					<td><c:forEach begin="1" end="${dto.indent}">
							&nbsp;&nbsp;
						</c:forEach> <c:if test="${dto.indent > 0 }">

							<img src='/images/re.jpg'>
						</c:if> <c:set var="rcount"
							value="${util:rcount(dto.bbsno,rservice) }" /> <a
						href="javascript:read('${dto.bbsno}')">${dto.title}</a> <c:if
							test="${rcount>0 }">
							<span class="badge">${rcount}</span>
						</c:if> 
						<%-- if (Utility.compareDay(dto.getWdate())) { --%>
						 <img src="../images/new.gif"> 
						<%-- } --%>
						</td>
					<td>${dto.wname}</td>
					<td>${dto.wdate}</td>
					<td>${dto.viewcnt}</td>
					<td><c:choose>
							<c:when test="${empty dto.filename}">파일없음</c:when>
							<c:otherwise>
								<a href="javascript:fileDown('${dto.filename}')">
									${dto.filename}</a>
							</c:otherwise>
						</c:choose></td>
				</tr>
			</c:forEach>

		</c:otherwise>
	</c:choose>
			</tbody>
		</table>
		<div>${paging}</div>
	</div>
</body>
</html>

```

![image](https://user-images.githubusercontent.com/101780699/173768086-2184e38b-cd47-4a34-906c-337308041f1b.png)



---



el-functions.tld 수정 new 이미지 출력 추가

```java
<?xml version="1.0" encoding="UTF-8" ?> 

<taglib xmlns="http://java.sun.com/xml/ns/j2ee" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee 
                        web-jsptaglibrary_2_0.xsd" 
    version="2.0"> 
     
    <description>EL에서 함수실행</description> 
    <tlib-version>1.0</tlib-version> 
    <uri>/ELFunctions</uri> 
   	<function>  
        <description>댓글 수 출력</description> 
        <name>rcount</name>  
        <function-class>
            com.study.utility.Utility
        </function-class>
        <function-signature> 
           int rcount( int, com.study.model.ReplyService ) 
        </function-signature> 
    </function> 
    
       	<function>  
        <description>new 이미지 출력</description> 
        <name>newImg</name>  
        <function-class>
            com.study.utility.Utility
        </function-class>
        <function-signature> 
           boolean compareDay( java.lang.String ) 
        </function-signature> 
    </function> 
    
</taglib>
```



list.jsp 수정 new 이미지가 보이도록 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="util" uri="/ELFunctions"%>
<!DOCTYPE html>
<html>
<head>
<title>homepage</title>
<meta charset="utf-8">
<script type="text/javascript">
	function read(bbsno) {
		let url = 'read/' + bbsno;//bbsno를 경로로 가져가는것
		url += "?nowPage=${nowPage}";
		url += "&col=${col}";
		url += "&word=${word}";
		location.href = url;
	}

	function fileDown(filename) {
		var url = "./fileDown";
		url += "?filename=" + filename;
		location.href = url;
	}
</script>
</head>
<body>
	<div class="container">
		<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
		<form action="list" class='form-inline'>
			<div class='form-group'>
				<select class='form-control' name='col'>
					<option value="wname"
						<c:if test="${col == 'wname' }">selected</c:if>>성명</option>

					<option value="title"
						<c:if test="${col == 'title' }">selected</c:if>>제목</option>

					<option value="content"
						<c:if test="${col == 'content' }">selected</c:if>>내용</option>

					<option value="title_content"
						<c:if test="${col == 'title_content' }">selected</c:if>>제목+내용</option>

					<option value="total"
						<c:if test="${col == 'total' }">selected</c:if>>전체출력</option>

				</select>
			</div>
			<div class="form-group">
				<input type='text' class='form-control' placeholder='Enter 검색어'
					name='word' value="${word}">
			</div>
			<button class='btn btn-default'>검색</button>
			<button class='btn btn-default' type='button'
				onclick="location.href='create'">등록</button>
		</form>
		<table class="table table-striped">
			<thead>
				<tr>
					<th>번호</th>
					<th>제목</th>
					<th>작성자</th>
					<th>등록날짜</th>
					<th>조회수</th>
					<th>파일명</th>

				</tr>
			</thead>
			<tbody>

	<c:choose>
		<c:when test="${empty list}">

			<tr>
				<td colspan='6'>등록된 글이 없습니다.</td>
			</tr>

		</c:when>

		<c:otherwise>

			<c:forEach var="dto" items="${list}">

				<tr>
					<td>${dto.bbsno}</td>
					<td><c:forEach begin="1" end="${dto.indent}">
							&nbsp;&nbsp;
						</c:forEach> <c:if test="${dto.indent > 0 }">

							<img src='/images/re.jpg'>
						</c:if> <c:set var="rcount"
							value="${util:rcount(dto.bbsno,rservice) }" /> <a
						href="javascript:read('${dto.bbsno}')">${dto.title}</a> <c:if
							test="${rcount> 0 }">
							<span class="badge">${rcount}</span>
						</c:if> 
						<c:if test="${util:newImg(dto.wdate) }">
						 <img src="../images/new.gif"> 
						</c:if>
						</td>
					<td>${dto.wname}</td>
					<td>${dto.wdate}</td>
					<td>${dto.viewcnt}</td>
					<td><c:choose>
							<c:when test="${empty dto.filename}">파일없음</c:when>
							<c:otherwise>
								<a href="javascript:fileDown('${dto.filename}')">
									${dto.filename}</a>
							</c:otherwise>
						</c:choose></td>
				</tr>
			</c:forEach>

		</c:otherwise>
	</c:choose>
			</tbody>
		</table>
		<div>${paging}</div>
	</div>
</body>
</html>

```





---

---





## [01] Spring Boot 공지사항 만들기

### 1. 데이터베이스 설정
(1) 서버실행
 \- study/mariadb_server.bat 관리자 권한으로 실행하여 서버를 실행한다.
 \- 작업관리자에서 mysqld.exe가 실행하고 있는지 확인한다.

 \- HeidiSQL을 열어서 테이블을 생성한다.



```sql
use webtest;
-- DDL
drop table if exists notice;
CREATE TABLE notice(
  noticeno      INT                        NOT NULL AUTO_INCREMENT COMMENT '글 번호',
  title             VARCHAR(300)         NOT NULL COMMENT '제목',
  content       TEXT                       NOT NULL COMMENT '내용',
  wname        VARCHAR (20)           NOT NULL COMMENT '작성자',
  passwd        VARCHAR (20)           NULL COMMENT '패스워드',
  cnt             SMALLINT                 NOT NULL DEFAULT '0' COMMENT '조회수',
  rdate          DATETIME                  NOT NULL COMMENT '등록일',
  PRIMARY KEY (noticeno)  
);                         reply
 
-- 등록
INSERT INTO notice(title, content, wname, passwd, cnt, rdate)
VALUES('spring 시즌 접수 안내 1', '10% 할인 실시!', '왕눈이', '1234', 0, NOW());
INSERT INTO notice(title, content, wname, passwd, cnt, rdate)
VALUES('spring 시즌 접수 안내 2', '10% 할인 실시!', '아로미', '1234', 0, NOW());
INSERT INTO notice(title, content, wname, passwd, cnt, rdate)
VALUES('spring 시즌 접수 안내 3', '10% 할인 실시!', '투투투', '1234', 0, now());
-- 목록
SELECT noticeno, title, content, wname, passwd, cnt, rdate
FROM notice
ORDER BY noticeno DESC;
-- 조회
SELECT noticeno, title, content, wname, passwd, cnt, rdate
FROM notice
WHERE noticeno=1;
-- 조회수증가
UPDATE notice
SET cnt = cnt + 1
WHERE noticeno=1;
-- 수정
UPDATE notice
SET title='추가 공지', content='5% 추가 할인!', wname='아로미'
WHERE noticeno=1;
-- 패스워드 확인
SELECT COUNT(*) AS cnt
FROM notice
WHERE noticeno=1 AND passwd='1234';
-- 삭제
DELETE FROM notice
WHERE noticeno=3;
 
SELECT * FROM notice;
```

### 2. Lombok을 이용하여 DTO(Data Transfer Object) 생성하기 
 \- 롬복을 이용하면 getter, setter, toString등을 코드 없이
  자동으로 생성해준다.
(1) 롬복 설치하기
 \- 롬복 홈페이지에서 롬복 플러그인을 다운받아 설치한다.
[ ](https://projectlombok.org/download)**https://projectlombok.org/download**

![image](https://user-images.githubusercontent.com/101780699/173773797-8db446c8-95d6-42e4-86eb-009b556ad801.png)

 **- 설치전 sts는 종료시킨다.**
 \- 도스를 관리자 권한으로 실행후

![image](https://user-images.githubusercontent.com/101780699/173774012-a0e70a17-59d9-4390-8f5e-e8c9192ac0fa.png)

  G:\tstudy\datadown>java -jar lombok.jar 

cd \(역슬래쉬)

cd aistudy

cd aistudy

cd datadown

java -jar lombok.jar 

![image](https://user-images.githubusercontent.com/101780699/173774177-57fc2b92-0879-4275-a3eb-3f4db4fd2e51.png)

![image](https://user-images.githubusercontent.com/101780699/173774398-525b22a3-33dc-41ab-ac24-37acc9aee3d5.png)

![image](https://user-images.githubusercontent.com/101780699/173774701-723e6dd4-4188-492d-a35c-c52d234fb32e.png)

![image](https://user-images.githubusercontent.com/101780699/173774480-e87ae385-aedf-447a-ba7b-fac1df607249.png)



![image](https://user-images.githubusercontent.com/101780699/173774263-17e9060b-8264-4b6e-9fbd-f3a14e403a98.png)

![image](https://user-images.githubusercontent.com/101780699/173774274-b883818c-88c1-4ee3-8bef-42ca4a791430.png)





---



## [01] Spring Boot Controller JUnit4 테스트

1. notice project 생성

![image](https://user-images.githubusercontent.com/101780699/173776618-ca70b9c9-d37d-4a17-b1d6-61fc2fadc632.png)

![image](https://user-images.githubusercontent.com/101780699/173776718-814dc55f-6baa-4e0e-be2c-0ff4b6e79010.png)





build.gradle 수정

```java
plugins {
	id 'org.springframework.boot' version '2.7.0'
	id 'io.spring.dependency-management' version '1.0.11.RELEASE'
	id 'java'
	id 'war'
}

group = 'com.study.notice'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '11'

configurations {
	compileOnly {
		extendsFrom annotationProcessor
	}
}

repositories {
	mavenCentral()
}

dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-jdbc'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter:2.2.2'
	compileOnly 'org.projectlombok:lombok'
	developmentOnly 'org.springframework.boot:spring-boot-devtools'
	runtimeOnly 'mysql:mysql-connector-java'
	annotationProcessor 'org.projectlombok:lombok'
	providedRuntime 'org.springframework.boot:spring-boot-starter-tomcat'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'
    implementation 'javax.servlet:jstl'  
	implementation 'org.apache.tomcat.embed:tomcat-embed-jasper'  
    implementation 'org.springframework.boot:spring-boot-starter-validation'   
    runtimeOnly 'mysql:mysql-connector-java'
    implementation group: 'org.apache.tiles', name: 'tiles-jsp', version: '3.0.8'
}

tasks.named('test') {
	useJUnitPlatform()
}

```



application.properties 수정

```properties
server.port=8000
# DEVTOOLS (DevToolsProperties)
spring.devtools.livereload.enabled=true
# jsp 설정
spring.mvc.view.prefix=/WEB-INF/views/
spring.mvc.view.suffix=.jsp
#mysql
spring.datasource.hikari.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.hikari.jdbc-url=jdbc:mysql://127.0.0.1:3306/webtest?useUnicode=true&characterEncoding=utf8
spring.datasource.hikari.username=javauser
spring.datasource.hikari.password=1234
# All DBMS
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=5000
```



model 패키지 및 NoticeDTO 생성

```java
package com.study.model;
import lombok.Data;
@Data
public class NoticeDTO {
  private int    noticeno     ;
  private String title        ;
  private String content      ;
  private String wname        ;
  private String passwd       ;
  private int    cnt          ;
  private String rdate        ;
 
}
```



NoticeApplication.java

```java
package com.study.notice;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.ComponentScan;

@SpringBootApplication
@ComponentScan(basePackages= {"com.study.*"})
public class NoticeApplication {


  public static void main(String[] args) {
    SpringApplication.run(NoticeApplication.class, args);
	}

}

```



![image](https://user-images.githubusercontent.com/101780699/173778514-dca9f90f-5b6a-42e1-9a36-87953c8eb877.png)

붙여넣기



### spirng_bbs에서 `DatabaseConfiguration.java ` `TilesConfiguration.java `  notice로붙여넣기

resource/mybatis 패키지 생성

tiles.xml 붙여넣기

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE tiles-definitions PUBLIC
       "-//Apache Software Foundation//DTD Tiles Configuration 3.0//EN"
       "http://tiles.apache.org/dtds/tiles-config_3_0.dtd">
 
<tiles-definitions>
  <!-- main -->
  <definition name="main"
    template="/WEB-INF/views/template/template.jsp">
    <put-attribute name="header"
      value="/WEB-INF/views/template/top.jsp" />
  </definition>
  <definition name="/home" extends="main">
    <put-attribute name="title" value="기본페이지"></put-attribute>
    <put-attribute name="body"
      value="/WEB-INF/views/index.jsp" />
  </definition>
 

</tiles-definitions>
```



NoticeApplicationTests.java 수정  spring_bbs 내용 붙여넣기

```java
package com.study.notice;

import org.junit.jupiter.api.Test;
import org.mybatis.spring.SqlSessionTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class NoticeApplicationTests {

  @Autowired
  private SqlSessionTemplate sqlSession;
  
  @Test
  void contextLoads() {
  }

   @Test
    public void testSqlSession() throws Exception{
      System.out.println(sqlSession.toString());
    }

}

```



초기 설정 완료

![image](https://user-images.githubusercontent.com/101780699/173780129-854830db-589f-42e6-a3fa-20a9f5905d2c.png)



top.jsp 수정 메모를 공지사항으로 수정

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%  String root = request.getContextPath(); %>    
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

</head>
<body>
 <!--상단메뉴-->
<div class="container">
  <div class="page-header row">
   <div class="col-sm-4">
    <img src="<%=root %>/images/img_chania.jpg" class="img-responsive img-thumbnail" alt="Cinque Terre" >
   </div>
   <div class="col-sm-8"><h1>Homepage</h1></div>     
  </div>
  <ul class="nav nav-tabs">
    <li class="active"><a href="<%=root%>/index.jsp">Home</a></li>
    <li class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">MVC 실습<span class="caret"></span></a>
      <ul class="dropdown-menu">
        <li><a href="<%=root%>/mvc/hello.do">인삿말</a></li>
        <li><a href="<%=root%>/mvc/date.do">오늘의 날짜</a></li>
        <li><a href="<%=root%>/mvc/myinfo.do">나의정보</a></li>                       
        <li><a href="<%=root%>/mvc/team.do">팀정보</a></li>                       
      </ul>
    </li>
    <li class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">게시판<span class="caret"></span></a>
      <ul class="dropdown-menu">
        <li><a href="<%=root%>/bbs/create">생성</a></li>
        <li><a href="<%=root%>/bbs/list">목록</a></li>                      
      </ul>
    </li>
    
    <li class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">공지사항<span class="caret"></span></a>
      <ul class="dropdown-menu">
        <li><a href="<%=root%>/notice/create">생성</a></li>
        <li><a href="<%=root%>/notice/list">목록</a></li>                      
      </ul>
    </li>
    
    <li><a href="#">Menu 2</a></li>
    <li><a href="#">Menu 3</a></li>
  </ul> 
</div>
</body>
</html>
```



### spring_bbs 속 images notice에 붙여넣기



### com.study.controller 패키지 만들고

NoticeController.java 생성

```java
package com.study.controller;

import java.text.DateFormat;
import java.util.Date;
import java.util.Locale;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class NoticeController {
  @GetMapping("/")
  public String home(Locale locale, Model model) {
    Date date = new Date();
    DateFormat dateFormat = DateFormat.getDateTimeInstance(DateFormat.LONG, DateFormat.LONG, locale);
    
    String formattedDate = dateFormat.format(date);
    
    model.addAttribute("serverTime", formattedDate );
    return "/home";
  }
}
```



index.jsp 수정 ${serverTime} 수정

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
 <div class="container">
  <div class="row">
  	${serverTime}
    <div class="col-sm-4">
      <h3>Column 1</h3>
      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
      <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
    </div>
    <div class="col-sm-4">
      <h3>Column 2</h3>
      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
      <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
    </div>
    <div class="col-sm-4">
      <h3>Column 3</h3>        
      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
      <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
    </div>
  </div>
</div>
</body>
</html>
```



![image](https://user-images.githubusercontent.com/101780699/173782034-5a81e7c6-8ee2-4319-895a-b0091ee27e2c.png)



---



## [01] 공지사항 등록, 목록 처리

###  Service영역 생성

\- Service 인터페이스와 ServiceImpl클래스를 만들어 사용한다.
\- 인터페이스와 구현클래스로 분리하는 장점
 ① 느스한 결합(loose coupling)으로 기능간의 의존관계 최소화

 ② 기능변화에 대한 최소한의 수정에 따른 유연성 최대화
 ③ 모듈화를 통한 높은 재사용성
 ④ 스프링의 IOC/DI 사용의 활용의 극대화



NoticeService.java 생성

```java
package com.study.model;
 
import java.util.List;
import java.util.Map;
 
public interface NoticeService {
  int create(NoticeDTO dto);
  List<NoticeDTO> list(Map map);
  int total(Map map);
}
```





NoticeServiceImpl.java 생성 및 수정

![image](https://user-images.githubusercontent.com/101780699/173783116-53bc669a-3227-40bf-862d-74a4ebcd7206.png)

```java
package com.study.model;

import java.util.List;
import java.util.Map;

import org.springframework.stereotype.Service;

@Service("com.study.model.NoticeServiceImpl")
public class NoticeServiceImpl implements NoticeService {

  @Override
  public int create(NoticeDTO dto) {
    // TODO Auto-generated method stub
    return 0;
  }

  @Override
  public List<NoticeDTO> list(Map map) {
    // TODO Auto-generated method stub
    return null;
  }

  @Override
  public int total(Map map) {
    // TODO Auto-generated method stub
    return 0;
  }

}

```



NoticeMapper iterface로 생성

```java
package com.study.model;

import java.util.List;
import java.util.Map;
   
  public interface NoticeMapper {
    int create(NoticeDTO dto);
    List<NoticeDTO> list(Map map);
    int total(Map map); 
}

```



NoticeServiceImpl.java 수정

```java
package com.study.model;

import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service("com.study.model.NoticeServiceImpl")
public class NoticeServiceImpl implements NoticeService {

  @Autowired
  private NoticeMapper mapper;
  
  @Override
  public int create(NoticeDTO dto) {
    // TODO Auto-generated method stub
    return mapper.create(dto);
  }

  @Override
  public List<NoticeDTO> list(Map map) {
    // TODO Auto-generated method stub
    return mapper.list(map);
  }

  @Override
  public int total(Map map) {
    // TODO Auto-generated method stub
    return mapper.total(map);
  }

}

```



### spring_bbs에 bbs.xml  mybatis로 붙여넣기 

notice.xml 수정 create, list, total 수정

```xml
<?xml version="1.0" encoding="UTF-8" ?> 
 
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.study.model.NoticeMapper">

	<insert id="create" parameterType="com.study.model.NoticeDTO">
		INSERT INTO notice(title,
		content, wname, passwd, cnt, rdate)
		VALUES(#{title}, #{content},
		#{wname}, #{passwd}, 0, NOW())
	</insert>

	<select id="list" parameterType="Map"
		resultType="com.study.model.NoticeDTO">
		SELECT noticeno, title, wname, cnt, rdate
		FROM notice
		<where>
			<choose>
				<when test="col=='wname'">
					wname like CONCAT('%',#{word},'%')
				</when>
				<when test="col=='title'">
					title like CONCAT('%',#{word},'%')
				</when>
				<when test="col=='content'">
					content like CONCAT('%',#{word},'%')
				</when>
				<when test="col=='title_content'">
					title like CONCAT('%',#{word},'%')
					or
					content like
					CONCAT('%',#{word},'%')
				</when>
			</choose>
		</where>
	</select>

	<select id="total" parameterType="Map" resultType="int">
		select count(*) from notice
		<where>
			<choose>
				<when test="col=='wname'">
					wname like CONCAT('%',#{word},'%')
				</when>
				<when test="col=='title'">
					title like CONCAT('%',#{word},'%')
				</when>
				<when test="col=='content'">
					content like CONCAT('%',#{word},'%')
				</when>
				<when test="col=='title_content'">
					title like CONCAT('%',#{word},'%')
					or
					content like CONCAT('%',#{word},'%')
				</when>
			</choose>
		</where>
	</select>

</mapper>
```

