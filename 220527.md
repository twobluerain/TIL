1. constant / DBOpen / DBClose .java  만들기

   1. 데이터베이스와 java를 연동하기 위함

   2. utility.java 생성 

   

2. SQL에 데이터 삽입

   1. 테이블 생성 후 데이터 삽입

   

3. DTO 생성

   1. SQL에 만든 변수들을 전부 private 지정
   2. superclass / fields / getters and setters / toString / override methods 선언

   

4. DAO 생성 (create 기능 추가)

   1.  create 선언
   2.  createForm. jsp 생성 (createForm 페이지에서 보이게 만드는 틀 역할)
   3.  createProc.jsp 생성 (form 에서 작성한 값들을 DTO에 저장하고 DB에 저장하는 역할)
   4. useBean을 통해 createProc의 입력값을 더 간편하게 바꿀 수 있다.

   

5. DAO 수정 (list 기능 추가)

   1.  list 선언
   2. list.jsp 생성 (list 페이지에서 보이게 만드는 틀 역할)
      

6. 검색 / Paging 기능 추가

   1. utiliy 수정 ( 한 페이지에 볼 수 있는 글의 수 설정)
   2. DAO에 total 추가 (검색 기능 추가 역할)
   3. DAO에 list 수정 (검색 기능 추가)
   4. list.jsp 수정 (검색 / Paging 기능 추가)

   

7. DAO 수정 (read 기능 추가)

   1. read 선언
   2. upViewcnt 선언 (조회수 기능 추가)
   3. read.jsp 생성 (해당 게시글을 클릭했을 때 read.jsp에서 작성 내용들을 보는 역할)
   4. list.jsp 수정 (게시글 클릭했을 때 read.jsp 페이지로 바뀌는 기능 추가)

   

8. DAO 수정 (update 기능 추가)

   1. update 선언
   2. updateForm.jsp 생성 (updateForm 페이지에서 보이게 만드는 틀 역할)
   3. list.jsp 수정 ()
   4. read.jsp 수정 (수정 버튼 기능 추가)

   

9. 패스워드 검사 기능 추가

   1. DAO에 passCheck 추가 (패스워드 검사 기능 추가 역할)

   

10. DAO 수정 (delete 기능 추가)

    1. delete 선언
    2. deleteForm.jsp 생성 (deleteForm 페이지에서 보이게 만드는 틀 역할)
    3. read.jsp 수정 (제거 버튼 기능 추가)
    4. deleteProc.jsp 생성 ( form에서 올바른 패스워드로 삭제한 값들을 없애주는 역할)

    

11. 답변 기능 추가

    1. DAO에 create 수정 (만들 때마다 grpno가 증가하도록)
    2. replyForm.jsp 생성 (replyForm 페이지에서 보이게 만드는 틀 역할)
    3. read.jsp 수정 (답변 버튼 기능 추가)
    4. DAO에 readReply 선언 ('게시글' read가 아닌 '답변' read 기능 역할)

    

12. 답변 처리 페이지 추가

    1. DAO에 createReply 선언 (답변을 생성할 때마다 grpno는 그대로 /  indent, ansnum이 1씩 증가하도록)
    2. DAO에 upAnsnum 선언 (답변의 순서를 정해주는 역할)
    3. replyProc.jsp 생성 (답변을 생성하는 역할)
    4. list.jsp 수정 (답변 기능?)

    

13. 새로운 글에 이미지 기능 추가

    1. SQL 수정 (날짜를 다르게 하기 위함)
    2. utility.java 수정 (등록 날짜와 비교하는 역할)
    3. list.jsp 수정 (이미지 추가하는 역할)





---



#### [01] 게시판 등록, 처리 실습

1. SQL

INSERT INTO bbs( wname, title, content, passwd, wdate)

VALUES('왕눈이', '제목', '내용', '123', sysdate());

2. DAO 및 DAO Test

```java
package bbs;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

import utility.DBClose;
import utility.DBOpen;

public class BbsDAO {
	public boolean create(BbsDTO dto) {
		boolean flag = false;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		StringBuffer sql = new StringBuffer();
		sql.append("   INSERT INTO bbs( wname, title, content, passwd, wdate)    ");
		sql.append("   VALUES(?,?,?,?, sysdate())      		");


		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setString(1, dto.getWname());
			pstmt.setString(2, dto.getTitle());
			pstmt.setString(3, dto.getContent());
			pstmt.setString(4, dto.getPasswd());

			int cnt = pstmt.executeUpdate();
			if(cnt>0) flag = true;

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}

	return flag;
	}
}
```

---

3. 등록 폼

게시판 jsp 생성

![image](https://user-images.githubusercontent.com/101780699/170008421-efabde28-f4ee-4c72-beb1-79d7337fcbbf.png)

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>

<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 생성</h1>
<form class="form-horizontal"
      action="createProc.jsp"
      method="post"
      >

  <div class="form-group">
    <label class="control-label col-sm-2" for="wname">작성자</label>
    <div class="col-sm-6">
      <input type="text" name="wname" id="wname" class="form-control">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="title">제목</label>
    <div class="col-sm-6">
      <input type="text" name="title" id="title" class="form-control">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="content">내용</label>
    <div class="col-sm-6">
    <textarea rows="5" cols="5" id="content" name="content" class="form-control"></textarea>
    </div>
  </div>

    <div class="form-group">
    <label class="control-label col-sm-2" for="passwd">비밀번호</label>
    <div class="col-sm-6">
      <input type="password" name="passwd" id="passwd" class="form-control">
    </div>
  </div>

   <div class="form-group">
   <div class="col-sm-offset-2 col-sm-5">
    <button class="btn">등록</button>
    <button type="reset" class="btn">취소</button>
   </div>
 </div>
</form>
</div>
</body>
</html>
```

---

4. 등록 처리

createForm.jsp 생성

![image](https://user-images.githubusercontent.com/101780699/170008476-54ed790a-a187-4193-9380-74d5443a45a9.png)

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>

<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 생성</h1>
<form class="form-horizontal"
      action="createProc.jsp"
      method="post"
      >

  <div class="form-group">
    <label class="control-label col-sm-2" for="wname">작성자</label>
    <div class="col-sm-6">
      <input type="text" name="wname" id="wname" class="form-control">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="title">제목</label>
    <div class="col-sm-6">
      <input type="text" name="title" id="title" class="form-control">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="content">내용</label>
    <div class="col-sm-6">
    <textarea rows="5" cols="5" id="content" name="content" class="form-control"></textarea>
    </div>
  </div>

    <div class="form-group">
    <label class="control-label col-sm-2" for="passwd">비밀번호</label>
    <div class="col-sm-6">
      <input type="password" name="passwd" id="passwd" class="form-control">
    </div>
  </div>

   <div class="form-group">
   <div class="col-sm-offset-2 col-sm-5">
    <button class="btn">등록</button>
    <button type="reset" class="btn">취소</button>
   </div>
 </div>
</form>
</div>
</body>
</html>
```

---

createProc.jsp 생성

![image](https://user-images.githubusercontent.com/101780699/170008515-3ef720b9-1f57-4ad2-9b68-963cce2697f3.png)

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    import="bbs.*"%>

<%// 1. form에서 넘겨준 Parameter 받기 2. Parameter를 DTO에 저장 3. DTO DB에 저장%>
<% 	request.setCharacterEncoding("utf-8");
	String wname = request.getParameter("wname");
	String title = request.getParameter("title");
	String content = request.getParameter("content");
	String passwd = request.getParameter("passwd");

	BbsDTO dto = new BbsDTO();
	dto.setWname(wname);
	dto.setTitle(title);
	dto.setContent(content);
	dto.setPasswd(passwd);

	BbsDAO dao = new BbsDAO();

	boolean flag = dao.create(dto);
%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<jsp:include page="/menu/top.jsp"></jsp:include>
<div class="container">
	<div class="well well-lg">
	<%
		if (flag){
			out.print("글 등록에 성공했습니다.");
		}else{
			out.print("글 등록에 실패했습니다.");
		}
	%>
	</div>
	<button class="btn" onclick="location.href='createForm.jsp'">다시 등록</button>
	<button class="btn" onclick="location.href='list.jsp'">목록</button>
</div>
</body>
</html>
```

sql db에서도 확인 가능하다.

![image](https://user-images.githubusercontent.com/101780699/170008569-6db10c24-58e8-4f06-aea1-007912b0b613.png)

---

createProc.jsp useBean을 통한 수정본

```java
<%@ page language="java" contentType="text/html; charset=UTF-8"
    import="bbs.*"%>
<% request.setCharacterEncoding("utf-8"); %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<jsp:useBean id="dto" class="bbs.BbsDTO" />
<jsp:setProperty name="dto" property="wname" />
<jsp:setProperty name="dto" property="title" />
<jsp:setProperty name="dto" property="content" />
<jsp:setProperty name="dto" property="passwd" />
<%
	boolean flag = dao.create(dto);
%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<jsp:include page="/menu/top.jsp"></jsp:include>
<div class="container">
	<div class="well well-lg">
	<%
		if (flag){
			out.print("글 등록에 성공했습니다.");
		}else{
			out.print("글 등록에 실패했습니다.");
		}
	%>
	</div>
	<button class="btn" onclick="location.href='createForm.jsp'">다시 등록</button>
	<button class="btn" onclick="location.href='list.jsp'">목록</button>
</div>
</body>
</html>
```

---

---

#### [01] 게시판 목록

1. 목록
   \- ASC: 오름 차순
   \- DESC: 내림 차순

![image](https://user-images.githubusercontent.com/101780699/170008606-bd458d50-84a7-40a4-9b96-b374bf10c0ed.png)

```
<%@ page contentType="text/html; charset=UTF-8" %>

<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>1</td>
			<td>EPL 득점왕</td>
			<td>손흥민</td>
			<td>2022-05-24</td>
			<td>0</td>
			<td>0</td>
			<td>0</td>
		</tr>
		<tr>
			<td>2</td>
			<td>EPL 득점왕</td>
			<td>손흥민</td>
			<td>2022-05-24</td>
			<td>0</td>
			<td>0</td>
			<td>0</td>
		</tr>
		<tr>
			<td>3</td>
			<td>EPL 득점왕</td>
			<td>손흥민</td>
			<td>2022-05-24</td>
			<td>0</td>
			<td>0</td>
			<td>0</td>
		</tr>
		<tr>
			<td>4</td>
			<td>EPL 득점왕</td>
			<td>손흥민</td>
			<td>2022-05-24</td>
			<td>0</td>
			<td>0</td>
			<td>0</td>
		</tr>
		<tr>
			<td>5</td>
			<td>EPL 득점왕</td>
			<td>손흥민</td>
			<td>2022-05-24</td>
			<td>0</td>
			<td>0</td>
			<td>0</td>
		</tr>
	</tbody>
</table>
<div>
	<button class="btn" onclick="location.href='createForm.jsp'">등록</button>
</div>
</div>
</body>
</html>
```

DB에서 읽어오도록 하는 수정본

![image](https://user-images.githubusercontent.com/101780699/170008645-39aced4d-b153-41c5-bc25-bb7b0df5dc1a.png)

```java
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import = "java.util.*, bbs.BbsDTO" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<% List<BbsDTO> list = dao.list(); %>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
	<% if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

	<% }else {
		for(int i=0; i<list.size(); i++) {
		BbsDTO dto = list.get(i);
	%>
		<tr>
			<td><%=dto.getBbsno()%></td>
			<td><%=dto.getTitle()%></td>
			<td><%=dto.getWname()%></td>
			<td><%=dto.getWdate()%></td>
			<td><%=dto.getGrpno()%></td>
			<td><%=dto.getIndent()%></td>
			<td><%=dto.getAnsnum()%></td>
		</tr>
<% 		} // for end
		} // if end
%>

	</tbody>
</table>
<div>
	<button class="btn" onclick="location.href='createForm.jsp'">등록</button>
</div>
</div>
</body>
</html>
```

---

검색기능

DAO list메소드 변경

![image](https://user-images.githubusercontent.com/101780699/170008702-8eb4d067-2c8b-4e34-af86-91404a75ed87.png)

```java
package bbs;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import utility.DBClose;
import utility.DBOpen;



public class BbsDAO {

	public List<BbsDTO> list(Map<String,String> map) {
		List<BbsDTO> list = new ArrayList<BbsDTO>();

		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		ResultSet rs = null;

		String col = map.get("col");
		String word = map.get("word");

		StringBuffer sql = new StringBuffer();
		sql.append("  SELECT bbsno, wname, title,  viewcnt, wdate, grpno, indent, ansnum ");
		sql.append("  FROM bbs 						 ");


		if(word.trim().length()>0 && col.equals("title_content")) {
			sql.append(" where title like concat('%',?,'%') ");
			sql.append(" or content like concat('%',?,'%') ");
		}	else if (word.trim().length() > 0) {
			sql.append(" where " + col + " like concat('%',?,'%')" );
		}

		sql.append("  ORDER BY bbsno desc, ansnum 			 ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			if(word.trim().length()>0 && col.equals("title_content")) {
				pstmt.setString(1, word);
				pstmt.setString(2, word);
			}	else if (word.trim().length() > 0) {
				pstmt.setString(1, word);
			}

			rs = pstmt.executeQuery();

		    while (rs.next()) {
		        BbsDTO dto = new BbsDTO();
		        dto.setBbsno(rs.getInt("bbsno"));
		        dto.setWname(rs.getString("wname"));
		        dto.setTitle(rs.getString("title"));
		        dto.setGrpno(rs.getInt("grpno"));
		        dto.setIndent(rs.getInt("indent"));
		        dto.setAnsnum(rs.getInt("ansnum"));

		        list.add(dto);
		      }
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}	finally {
			DBClose.close(rs, pstmt, con);
		}


		return list;
	}

	public boolean create(BbsDTO dto) {
		boolean flag = false;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		StringBuffer sql = new StringBuffer();
		sql.append("   INSERT INTO bbs( wname, title, content, passwd, wdate)    ");
		sql.append("   VALUES(?,?,?,?, sysdate())      		");


		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setString(1, dto.getWname());
			pstmt.setString(2, dto.getTitle());
			pstmt.setString(3, dto.getContent());
			pstmt.setString(4, dto.getPasswd());

			int cnt = pstmt.executeUpdate();
			if(cnt>0) flag = true;

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}

	return flag;
	}
}

```

```java
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import = "java.util.*, bbs.BbsDTO, utility.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
// 검색 관련 -----------
String col = Utility.checkNull(request.getParameter("col"));
String word = Utility.checkNull(request.getParameter("word"));

if(col.equals("total"))word = "";

Map<String,String> map = new HashMap<String,String>();
map.put("col", col);
map.put("word", word);

List<BbsDTO> list = dao.list(map);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<form class="form-inline" action="./list.jsp">
    <div class="form-group">
      <select class="form-control" name="col">
        <option value="wname"<% if(col.equals("wname")) out.print("selected");%>
        >성명</option>
        <option value="title"<% if(col.equals("title")) out.print("selected");%>
        >제목</option>
        <option value="content"<% if(col.equals("content")) out.print("selected");%>
        >내용</option>
        <option value="title_content"<% if(col.equals("title_content")) out.print("selected");%>
        >제목+내용</option>
        <option value="total"<% if(col.equals("total")) out.print("selected");%>
        >전체출력</option>
     </select>
    </div>
    <div class="form-group">
      <input type="text" class="form-control" placeholder="Enter 검색어"
      name="word" value="<%=word%>">
    </div>
    <button type="submit" class="btn btn-default">검색</button>
    <button type="button" class="btn btn-default" onclick="location.href='./createForm.jsp'">등록</button>
  </form>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
	<% if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

	<% }else {
		for(int i=0; i<list.size(); i++) {
		BbsDTO dto = list.get(i);
	%>
		<tr>
			<td><%=dto.getBbsno()%></td>
			<td><%=dto.getTitle()%></td>
			<td><%=dto.getWname()%></td>
			<td><%=dto.getWdate()%></td>
			<td><%=dto.getGrpno()%></td>
			<td><%=dto.getIndent()%></td>
			<td><%=dto.getAnsnum()%></td>
		</tr>
<% 		} // for end
		} // if end
%>

	</tbody>
</table>
<div>
	<button class="btn" onclick="location.href='createForm.jsp'">등록</button>
</div>
</div>
</body>
</html>
```

---

---

#### [01] PAGING의 원리, 구현, 사용

\- page는 1부터 시작
\- 레코드가 많은 경우 레코드를 분할하여 가져오는 기술, 보통
10~20개가 하나의 페이지로 구성되어 있음.
\- mysql 은 limit으로 지정

![image](https://user-images.githubusercontent.com/101780699/170008761-0343a4e5-4f14-4a43-84f8-19832c2748be.png)

utility.java 수정

```java
package utility;

public class Utility {

/**
 * @param totalRecord 전체 레코드수
 * @param nowPage     현재 페이지
 * @param recordPerPage 페이지당 레코드 수
 * @param col 검색 컬럼
 * @param word 검색어
 * @return 페이징 생성 문자열
 */
public static String paging(int totalRecord, int nowPage, int recordPerPage, String col, String word){
    int pagePerBlock = 5; // 블럭당 페이지 수
    int totalPage = (int)(Math.ceil((double)totalRecord/recordPerPage)); // 전체 페이지
    int totalGrp = (int)(Math.ceil((double)totalPage/pagePerBlock));// 전체 그룹
    int nowGrp = (int)(Math.ceil((double)nowPage/pagePerBlock));    // 현재 그룹
    int startPage = ((nowGrp - 1) * pagePerBlock) + 1; // 특정 그룹의 페이지 목록 시작
    int endPage = (nowGrp * pagePerBlock);             // 특정 그룹의 페이지 목록 종료

    StringBuffer str = new StringBuffer();
    str.append("<div style='text-align:center'>");
    str.append("<ul class='pagination'> ");
    int _nowPage = (nowGrp-1) * pagePerBlock; // 10개 이전 페이지로 이동
    if (nowGrp >= 2){
      str.append("<li><a href='./list.jsp?col="+col+"&word="+word+"&nowPage="+_nowPage+"'>이전</A></li>");
    }

    for(int i=startPage; i<=endPage; i++){
      if (i > totalPage){
        break;
      }

      if (nowPage == i){
        str.append("<li class='active'><a href=#>"+i+"</a></li>");
      }else{
        str.append("<li><a href='./list.jsp?col="+col+"&word="+word+"&nowPage="+i+"'>"+i+"</A></li>");
      }
    }

    _nowPage = (nowGrp * pagePerBlock)+1; // 10개 다음 페이지로 이동
    if (nowGrp < totalGrp){
      str.append("<li><A href='./list.jsp?col="+col+"&word="+word+"&nowPage="+_nowPage+"'>다음</A></li>");
    }
    str.append("</ul>");
    str.append("</div>");

    return str.toString();
 }
}
```

BbsDAO 수정

```java
package bbs;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import utility.DBClose;
import utility.DBOpen;

public class BbsDAO {

	public int total(Map map) { //col,word
		int total = 0;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		ResultSet rs = null;

		String col = (String)map.get("col"); //검색컬럼 : wname, title, content, title_content
		String word = (String)map.get("word"); //사용자가 입력한 단어 : 홍, test,

		StringBuffer sql = new StringBuffer();
		sql.append(" select count(*) from bbs ");

		if(word.trim().length() >0 && col.equals("title_content")) {
			sql.append(" where title like concat('%',?,'%') ");
			sql.append(" or content like concat('%',?,'%') ");
		}else if(word.trim().length() > 0) {
			sql.append(" where "+ col +" like concat('%',?,'%')" );
		}

		try {
			pstmt = con.prepareStatement(sql.toString());
			if(word.trim().length() >0 && col.equals("title_content")) {
				pstmt.setString(1, word);
				pstmt.setString(2, word);
			}else if(word.trim().length() > 0) {
				pstmt.setString(1, word);
			}

			rs = pstmt.executeQuery();

			if(rs.next()) {
				total = rs.getInt(1);
			}

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(rs, pstmt, con);
		}

		return total;
	}
	public List<BbsDTO> list(Map map) {
		List<BbsDTO > list = new ArrayList<BbsDTO>();
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		ResultSet rs = null;

		String col = (String)map.get("col"); //검색컬럼 : wname, title, content, title_content
		String word = (String)map.get("word"); //사용자가 입력한 단어 : 홍, test,
		int sno = (int)map.get("sno"); //레코드 시작위치
		int eno = (int)map.get("eno"); //가져올 건수

		StringBuffer sql = new StringBuffer();
		sql.append(" select bbsno, wname, title, viewcnt, wdate, grpno, indent, ansnum ");
		sql.append(" from bbs ");

		if(word.trim().length() >0 && col.equals("title_content")) {
			sql.append(" where title like concat('%',?,'%') ");
			sql.append(" or content like concat('%',?,'%') ");
		}else if(word.trim().length() > 0) {
			sql.append(" where "+ col +" like concat('%',?,'%')" );
		}

		sql.append(" order by grpno desc, ansnum  ");
		sql.append(" limit ?, ? ");

		int i =0;
		try {
			pstmt = con.prepareStatement(sql.toString());
			if(word.trim().length() >0 && col.equals("title_content")) {
				pstmt.setString(++i, word);
				pstmt.setString(++i, word);
			}else if(word.trim().length() > 0) {
				pstmt.setString(++i, word);
			}

			pstmt.setInt(++i, sno);
			pstmt.setInt(++i, eno);

			rs = pstmt.executeQuery();

			while(rs.next()) {
				BbsDTO dto = new BbsDTO();
				dto.setBbsno(rs.getInt("bbsno"));
				dto.setWname(rs.getString("wname"));
				dto.setTitle(rs.getString("title"));
				dto.setViewcnt(rs.getInt("viewcnt"));
				dto.setWdate(rs.getString("wdate"));
				dto.setGrpno(rs.getInt("grpno"));
				dto.setIndent(rs.getInt("indent"));
				dto.setAnsnum(rs.getInt("ansnum"));

				list.add(dto);
			}

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(rs, pstmt, con);
		}

		return list;
	}

	public boolean create(BbsDTO dto) {
		boolean flag = false;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		StringBuffer sql = new StringBuffer();
		sql.append(" insert into bbs(wname, title, content, passwd, wdate) ");
		sql.append(" values(?,?,?,?,sysdate()) ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setString(1, dto.getWname());
			pstmt.setString(2, dto.getTitle());
			pstmt.setString(3, dto.getContent());
			pstmt.setString(4, dto.getPasswd());

			int cnt = pstmt.executeUpdate();

			if(cnt>0) flag = true;

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}

		return flag;
	}
}


```

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*, bbs.BbsDTO, utility.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%

//검색관련--------------
String col = Utility.checkNull(request.getParameter("col"));
String word = Utility.checkNull(request.getParameter("word"));

if(col.equals("total"))word = "";

//페이징 관련---------------
int nowPage = 1;
if(request.getParameter("nowPage") != null){
	nowPage = Integer.parseInt(request.getParameter("nowPage"));
}

int recordPerPage = 5;

int sno = ((nowPage -1) * recordPerPage);
int eno = recordPerPage;

Map map = new HashMap();
map.put("col",col);
map.put("word",word);
map.put("sno",sno);
map.put("eno",eno);

List<BbsDTO> list = dao.list(map);
int total = dao.total(map);
String paging = Utility.paging(total, nowPage, recordPerPage, col, word);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<form action="list.jsp" class='form-inline'>
<div class='form-group'>
 <select class='form-control' name='col'>
 	<option value="wname" <%if(col.equals("wname")) out.print("selected");%>>성명</option>
 	<option value="title" <%if(col.equals("title")) out.print("selected");%>>제목</option>
 	<option value="content" <%if(col.equals("content")) out.print("selected");%> >내용</option>
 	<option value="title_content" <%if(col.equals("title_content")) out.print("selected");%>>제목+내용</option>
 	<option value="total" <%if(col.equals("total")) out.print("selected");%>>전체출력</option>
 </select>
</div>
<div class="form-group">
	<input type='text' class='form-control' placeholder='Enter 검색어' name='word' value="<%=word%>">
</div>
<button class='btn btn-default'>검색</button>
<button class='btn btn-default' type='button' onclick="location.href='createForm.jsp'">등록</button>
</form>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
<%  if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

<%  }else {
		for(int i=0 ; i < list.size() ; i++) {
	   	BbsDTO dto = list.get(i);
%>
		<tr>
			<td><%=dto.getBbsno() %></td>
			<td><%=dto.getTitle() %></td>
			<td><%=dto.getWname() %></td>
			<td><%=dto.getWdate() %></td>
			<td><%=dto.getGrpno() %></td>
			<td><%=dto.getIndent() %></td>
			<td><%=dto.getAnsnum() %></td>
		</tr>
<%     } //for end
    } //if end
%>
	</tbody>
</table>
<div>
	<%=paging %>
</div>
</div>
</body>
</html>
```





#### 조회(read.jsp) 및 조회수 증가

1. SQL UPDATE bbs SET viewcnt = viewcnt + 1 WHERE bbsno=1;
2. SELECT bbsno, wname, title, content, viewcnt, wdate FROM bbs WHERE bbsno = 1;

3. DAO 및 DAO Test

(1) DAO read 만들기

```
	public BbsDTO read(int bbsno) {
		BbsDTO dto = null;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		ResultSet rs = null;

		StringBuffer sql = new StringBuffer();
		sql.append("  SELECT bbsno, wname, title, content, viewcnt, wdate ");
		sql.append("  FROM bbs   ");
		sql.append("  WHERE bbsno = ?  ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setInt(1, bbsno);

			rs = pstmt.executeQuery();

			if(rs.next()) {
				dto = new BbsDTO();
				dto.setBbsno(rs.getInt("bbsno"));
				dto.setWname(rs.getString("wname"));
				dto.setTitle(rs.getString("title"));
				dto.setContent(rs.getString("content"));
				dto.setViewcnt(rs.getInt("viewcnt"));
				dto.setWdate(rs.getString("wdate"));
			}

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(rs, pstmt, con);
		}

		return dto;
	}

public void upViewcnt(int bbsno) {
	Connection con = DBOpen.getConnection();
	PreparedStatement pstmt = null;

	StringBuffer sql = new StringBuffer();
	sql.append(" UPDATE bbs 			   ");
	sql.append(" SET viewcnt = viewcnt + 1 ");
	sql.append(" WHERE bbsno = ?	       ");

	try {
		pstmt = con.prepareStatement(sql.toString());
		pstmt.setInt(1, bbsno);

		pstmt.executeUpdate();
	} catch (SQLException e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
	} finally {
		DBClose.close(pstmt, con);
	}
```

(2) DAO upViewcnt 만들기

```
	public void upViewcnt(int bbsno) {
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;

		StringBuffer sql = new StringBuffer();
		sql.append(" UPDATE bbs 			   ");
		sql.append(" SET viewcnt = viewcnt + 1 ");
		sql.append(" WHERE bbsno = ?	       ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setInt(1, bbsno);

			pstmt.executeUpdate();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}



	}
```

(3) read.jsp 만들기

```
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	dao.upViewcnt(bbsno);
	BbsDTO dto = dao.read(bbsno); // 레코드 조회

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1>조회</h1>
<div class = "panel panel-default">
	<div class="panel-heading">작성자</div>
	<div class="panel-body"><%=dto.getWname() %></div>
	<div class="panel-heading">제목</div>
	<div class="panel-body"><%=dto.getTitle() %></div>
	<div class="panel-heading">내용</div>
	<div class="panel-body" style='height:170px'><%=dto.getContent() %></div>
	<div class="panel-heading">조회수</div>
	<div class="panel-body"><%=dto.getViewcnt() %></div>
	<div class="panel-heading">등록일</div>
	<div class="panel-body"><%=dto.getWdate() %></div>
</div>
<div>
	<button type="button" class="btn" onclick="location.href='createForm.jsp'">등록</button>
	<button type="button" class="btn" onclick="updateM()">수정</button>
	<button type="button" class="btn" onclick="deleteM()">삭제</button>
	<button type="button" class="btn" onclick="location.href='list.jsp'">목록</button>
</div>
</div>
</body>
</html>
```

완성 후 1번 글(http://localhost:8000/webtest/bbs/read.jsp?bbsno=1)을 보았을 때

![img](https://blog.kakaocdn.net/dn/BoZeF/btrC4gSj0YW/P5JKuXAXxoiKQstbWuBA91/img.png)

---

---

게시글을 누르면 반응하게끔 만들기

list.jsp 수정하기

![image](https://user-images.githubusercontent.com/101780699/170158875-335e65b5-2b7c-4d0d-bf94-af86198ab193.png)

```java
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*, bbs.BbsDTO, utility.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%

//검색관련--------------
String col = Utility.checkNull(request.getParameter("col"));
String word = Utility.checkNull(request.getParameter("word"));

if(col.equals("total"))word = "";

//페이징 관련---------------
int nowPage = 1;
if(request.getParameter("nowPage") != null){
	nowPage = Integer.parseInt(request.getParameter("nowPage"));
}

int recordPerPage = 5;

int sno = ((nowPage -1) * recordPerPage);
int eno = recordPerPage;

Map map = new HashMap();
map.put("col",col);
map.put("word",word);
map.put("sno",sno);
map.put("eno",eno);

List<BbsDTO> list = dao.list(map);
int total = dao.total(map);
String paging = Utility.paging(total, nowPage, recordPerPage, col, word);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script type ="text/javascript">
  	function read(bbsno){
  		alert(bbsno);
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<form action="list.jsp" class='form-inline'>
<div class='form-group'>
 <select class='form-control' name='col'>
 	<option value="wname" <%if(col.equals("wname")) out.print("selected");%>>성명</option>
 	<option value="title" <%if(col.equals("title")) out.print("selected");%>>제목</option>
 	<option value="content" <%if(col.equals("content")) out.print("selected");%> >내용</option>
 	<option value="title_content" <%if(col.equals("title_content")) out.print("selected");%>>제목+내용</option>
 	<option value="total" <%if(col.equals("total")) out.print("selected");%>>전체출력</option>
 </select>
</div>
<div class="form-group">
	<input type='text' class='form-control' placeholder='Enter 검색어' name='word' value="<%=word%>">
</div>
<button class='btn btn-default'>검색</button>
<button class='btn btn-default' type='button' onclick="location.href='createForm.jsp'">등록</button>
</form>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
<%  if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

<%  }else {
		for(int i=0 ; i < list.size() ; i++) {
	   	BbsDTO dto = list.get(i);
%>
		<tr>
			<td><%=dto.getBbsno() %></td>
			<td><a href="javascript:read('<%=dto.getBbsno() %>')"><%=dto.getTitle() %></td>
			<td><%=dto.getWname() %></td>
			<td><%=dto.getWdate() %></td>
			<td><%=dto.getGrpno() %></td>
			<td><%=dto.getIndent() %></td>
			<td><%=dto.getAnsnum() %></td>
		</tr>
<%     } //for end
    } //if end
%>
	</tbody>
</table>
<div>
	<%=paging %>
</div>
</div>
</body>
</html>
```

누르면 그 글로 들어가기

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*, bbs.BbsDTO, utility.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%

//검색관련--------------
String col = Utility.checkNull(request.getParameter("col"));
String word = Utility.checkNull(request.getParameter("word"));

if(col.equals("total"))word = "";

//페이징 관련---------------
int nowPage = 1;
if(request.getParameter("nowPage") != null){
	nowPage = Integer.parseInt(request.getParameter("nowPage"));
}

int recordPerPage = 5;

int sno = ((nowPage -1) * recordPerPage);
int eno = recordPerPage;

Map map = new HashMap();
map.put("col",col);
map.put("word",word);
map.put("sno",sno);
map.put("eno",eno);

List<BbsDTO> list = dao.list(map);
int total = dao.total(map);
String paging = Utility.paging(total, nowPage, recordPerPage, col, word);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script type ="text/javascript">
  	function read(bbsno){
  		let url = 'read.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<form action="list.jsp" class='form-inline'>
<div class='form-group'>
 <select class='form-control' name='col'>
 	<option value="wname" <%if(col.equals("wname")) out.print("selected");%>>성명</option>
 	<option value="title" <%if(col.equals("title")) out.print("selected");%>>제목</option>
 	<option value="content" <%if(col.equals("content")) out.print("selected");%> >내용</option>
 	<option value="title_content" <%if(col.equals("title_content")) out.print("selected");%>>제목+내용</option>
 	<option value="total" <%if(col.equals("total")) out.print("selected");%>>전체출력</option>
 </select>
</div>
<div class="form-group">
	<input type='text' class='form-control' placeholder='Enter 검색어' name='word' value="<%=word%>">
</div>
<button class='btn btn-default'>검색</button>
<button class='btn btn-default' type='button' onclick="location.href='createForm.jsp'">등록</button>
</form>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
<%  if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

<%  }else {
		for(int i=0 ; i < list.size() ; i++) {
	   	BbsDTO dto = list.get(i);
%>
		<tr>
			<td><%=dto.getBbsno() %></td>
			<td><a href="javascript:read('<%=dto.getBbsno() %>')"><%=dto.getTitle() %></td>
			<td><%=dto.getWname() %></td>
			<td><%=dto.getWdate() %></td>
			<td><%=dto.getGrpno() %></td>
			<td><%=dto.getIndent() %></td>
			<td><%=dto.getAnsnum() %></td>
		</tr>
<%     } //for end
    } //if end
%>
	</tbody>
</table>
<div>
	<%=paging %>
</div>
</div>
</body>
</html>
```

---

---

#### 게시판 수정

1. 수정폼 생성

 (1) DAO update 만들기

```java
	public boolean update(BbsDTO dto) {
		boolean flag = false;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;

		StringBuffer sql = new StringBuffer();
		sql.append("  UPDATE bbs   ");
		sql.append("  SET   ");
		sql.append("  	wname= 	 ?,  ");
		sql.append("  	title=	 ?,  ");
		sql.append("  	content= ?   ");
		sql.append("  WHERE bbsno = ?  ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setString(1, dto.getWname());
			pstmt.setString(2, dto.getTitle());
			pstmt.setString(3, dto.getContent());
			pstmt.setInt(4, dto.getBbsno());

			int cnt = pstmt.executeUpdate();
			if(cnt>0)flag = true;

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}


		return flag;
	}
```

수정 updateForm.jsp 만들기

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	BbsDTO dto = dao.read(bbsno);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 수정</h1>
<form class="form-horizontal"
      action="updateProc.jsp"
      method="post"
      >
  <input type="hidden" name="bbsno" value="<%=bbsno%>">
  <div class="form-group">
    <label class="control-label col-sm-2" for="wname">작성자</label>
    <div class="col-sm-6">
      <input type="text" name="wname" id="wname" class="form-control" value="<%=dto.getWname()%>">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="title">제목</label>
    <div class="col-sm-6">
      <input type="text" name="title" id="title" class="form-control" value="<%=dto.getWname()%>">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="content">내용</label>
    <div class="col-sm-6">
    <textarea rows="5" cols="5" id="content" name="content" class="form-control"  ><%=dto.getContent()%></textarea>
    </div>
  </div>

    <div class="form-group">
    <label class="control-label col-sm-2" for="passwd">비밀번호</label>
    <div class="col-sm-6">
      <input type="password" name="passwd" id="passwd" class="form-control">
    </div>
  </div>

   <div class="form-group">
   <div class="col-sm-offset-2 col-sm-5">
    <button class="btn">수정</button>
    <button type="reset" class="btn">취소</button>
   </div>
 </div>
</form>
</div>
</body>
</html>
```

list.jsp 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*, bbs.BbsDTO, utility.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%

//검색관련--------------
String col = Utility.checkNull(request.getParameter("col"));
String word = Utility.checkNull(request.getParameter("word"));

if(col.equals("total"))word = "";

//페이징 관련---------------
int nowPage = 1;
if(request.getParameter("nowPage") != null){
	nowPage = Integer.parseInt(request.getParameter("nowPage"));
}

int recordPerPage = 5;

int sno = ((nowPage -1) * recordPerPage);
int eno = recordPerPage;

Map map = new HashMap();
map.put("col",col);
map.put("word",word);
map.put("sno",sno);
map.put("eno",eno);

List<BbsDTO> list = dao.list(map);
int total = dao.total(map);
String paging = Utility.paging(total, nowPage, recordPerPage, col, word);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script type ="text/javascript">
  	function read(bbsno){
  		let url = 'read.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<form action="list.jsp" class='form-inline'>
<div class='form-group'>
 <select class='form-control' name='col'>
 	<option value="wname" <%if(col.equals("wname")) out.print("selected");%>>성명</option>
 	<option value="title" <%if(col.equals("title")) out.print("selected");%>>제목</option>
 	<option value="content" <%if(col.equals("content")) out.print("selected");%> >내용</option>
 	<option value="title_content" <%if(col.equals("title_content")) out.print("selected");%>>제목+내용</option>
 	<option value="total" <%if(col.equals("total")) out.print("selected");%>>전체출력</option>
 </select>
</div>
<div class="form-group">
	<input type='text' class='form-control' placeholder='Enter 검색어' name='word' value="<%=word%>">
</div>
<button class='btn btn-default'>검색</button>
<button class='btn btn-default' type='button' onclick="location.href='createForm.jsp'">등록</button>
</form>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
<%  if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

<%  }else {
		for(int i=0 ; i < list.size() ; i++) {
	   	BbsDTO dto = list.get(i);
%>
		<tr>
			<td><%=dto.getBbsno() %></td>
			<td><a href="javascript:read('<%=dto.getBbsno() %>')"><%=dto.getTitle() %></td>
			<td><%=dto.getWname() %></td>
			<td><%=dto.getWdate() %></td>
			<td><%=dto.getGrpno() %></td>
			<td><%=dto.getIndent() %></td>
			<td><%=dto.getAnsnum() %></td>
		</tr>
<%     } //for end
    } //if end
%>
	</tbody>
</table>
<div>
	<%=paging %>
</div>
</div>
</body>
</html>
```

read.jsp 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	dao.upViewcnt(bbsno);
	BbsDTO dto = dao.read(bbsno); // 레코드 조회

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script>
  	function update(bbsno){
  		// alert(bbsno);
  		let url = 'updateForm.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1>조회</h1>
<div class = "panel panel-default">
	<div class="panel-heading">작성자</div>
	<div class="panel-body"><%=dto.getWname() %></div>
	<div class="panel-heading">제목</div>
	<div class="panel-body"><%=dto.getTitle() %></div>
	<div class="panel-heading">내용</div>
	<div class="panel-body" style='height:170px'><%=dto.getContent() %></div>
	<div class="panel-heading">조회수</div>
	<div class="panel-body"><%=dto.getViewcnt() %></div>
	<div class="panel-heading">등록일</div>
	<div class="panel-body"><%=dto.getWdate() %></div>
</div>
<div>
	<button type="button" class="btn" onclick="location.href='createForm.jsp'">등록</button>
	<button type="button" class="btn" onclick="update('<%=bbsno%>')">수정</button>
	<button type="button" class="btn" onclick="deleteM()">삭제</button>
	<button type="button" class="btn" onclick="location.href='list.jsp'">목록</button>
</div>
</div>
</body>
</html>
```

수정을 눌렀을 때

![image](https://user-images.githubusercontent.com/101780699/170175679-a1823395-1d95-477f-9c11-d0c3fa7ef418.png)

---

#### 게시판 수정

updateProc.jsp 생성

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    import="bbs.*, java.util.* "%>

<% request.setCharacterEncoding("utf-8"); %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<jsp:useBean id="dto" class="bbs.BbsDTO" />
<%//  String wname = request.getParameter("wname"); 랑    dto.setWname(wname); 합친 코드 */ %>
<%//  property 에서 '*'를 쓰면 모든 속성 된다.' */ %>
<jsp:setProperty name="dto" property="*" />

<%
	Map map = new HashMap();
	map.put("bbsno", dto.getBbsno());
	map.put("passwd", dto.getPasswd());
	boolean pflag = dao.passCheck(map);
	boolean flag = false;
	if(pflag) {  //올바른 비밀번호

		flag = dao.update(dto);  //수정처리
	}

    %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<jsp:include page="/menu/top.jsp"></jsp:include>
<div class="container">
	<div class="well well-lg">
	<%
		if(!pflag) { //비번 잘못되었을 때
			out.print("잘못된 비밀번호 입니다.");
		} else if(flag){
			out.print("글 수정 성공입니다.");
		} else {
			out.print("글 수정 실패입니다.");
		}
	%>
	</div>

	<% if(!pflag) { %>
		<button class = 'btn' onclick="history.back()">다시시도</button>
	<% } %>
	<button class='btn' onclick="location.href='createForm.jsp'">다시등록</button>
	<button class='btn' onclick="location.href='list.jsp'">목록으로</button>
</div>

</body>
</html>
```

updateForm.jsp 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	BbsDTO dto = dao.read(bbsno);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 글 수정</h1>
<form class="form-horizontal"
      action="updateProc.jsp"
      method="post"
      >
  <input type="hidden" name='bbsno' value="<%=bbsno%>">
  <div class="form-group">
    <label class="control-label col-sm-2" for="wname">작성자</label>
    <div class="col-sm-6">
      <input type="text" name="wname" id="wname" class="form-control" value="<%=dto.getWname()%>">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="title">제목</label>
    <div class="col-sm-6">
      <input type="text" name="title" id="title" class="form-control" value="<%=dto.getWname()%>">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="content">내용</label>
    <div class="col-sm-6">
    <textarea rows="5" cols="5" id="content" name="content" class="form-control"><%=dto.getContent()%></textarea>
    </div>
  </div>

    <div class="form-group">
    <label class="control-label col-sm-2" for="passwd">비밀번호</label>
    <div class="col-sm-6">
      <input type="password" name="passwd" id="passwd" class="form-control">
    </div>
  </div>

   <div class="form-group">
   <div class="col-sm-offset-2 col-sm-5">
    <button class="btn">수정</button>
    <button type="reset" class="btn">취소</button>
   </div>
 </div>
</form>
</div>
</body>
</html>
```

list.jsp 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*, bbs.BbsDTO, utility.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%

//검색관련--------------
String col = Utility.checkNull(request.getParameter("col"));
String word = Utility.checkNull(request.getParameter("word"));

if(col.equals("total"))word = "";

//페이징 관련---------------
int nowPage = 1;
if(request.getParameter("nowPage") != null){
	nowPage = Integer.parseInt(request.getParameter("nowPage"));
}

int recordPerPage = 5;

int sno = ((nowPage -1) * recordPerPage);
int eno = recordPerPage;

Map map = new HashMap();
map.put("col",col);
map.put("word",word);
map.put("sno",sno);
map.put("eno",eno);

List<BbsDTO> list = dao.list(map);
int total = dao.total(map);
String paging = Utility.paging(total, nowPage, recordPerPage, col, word);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script type ="text/javascript">
  	function read(bbsno){
  		let url = 'read.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<form action="list.jsp" class='form-inline'>
<div class='form-group'>
 <select class='form-control' name='col'>
 	<option value="wname" <%if(col.equals("wname")) out.print("selected");%>>성명</option>
 	<option value="title" <%if(col.equals("title")) out.print("selected");%>>제목</option>
 	<option value="content" <%if(col.equals("content")) out.print("selected");%> >내용</option>
 	<option value="title_content" <%if(col.equals("title_content")) out.print("selected");%>>제목+내용</option>
 	<option value="total" <%if(col.equals("total")) out.print("selected");%>>전체출력</option>
 </select>
</div>
<div class="form-group">
	<input type='text' class='form-control' placeholder='Enter 검색어' name='word' value="<%=word%>">
</div>
<button class='btn btn-default'>검색</button>
<button class='btn btn-default' type='button' onclick="location.href='createForm.jsp'">등록</button>
</form>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
<%  if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

<%  }else {
		for(int i=0 ; i < list.size() ; i++) {
	   	BbsDTO dto = list.get(i);
%>
		<tr>
			<td><%=dto.getBbsno() %></td>
			<td><a href="javascript:read('<%=dto.getBbsno() %>')"><%=dto.getTitle() %></td>
			<td><%=dto.getWname() %></td>
			<td><%=dto.getWdate() %></td>
			<td><%=dto.getGrpno() %></td>
			<td><%=dto.getIndent() %></td>
			<td><%=dto.getAnsnum() %></td>
		</tr>
<%     } //for end
    } //if end
%>
	</tbody>
</table>
<div>
	<%=paging %>
</div>
</div>
</body>
</html>
```

read.jsp 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	dao.upViewcnt(bbsno);
	BbsDTO dto = dao.read(bbsno); // 레코드 조회

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script>
  	function update(bbsno){
  		// alert(bbsno);
  		let url = 'updateForm.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1>조회</h1>
<div class = "panel panel-default">
	<div class="panel-heading">작성자</div>
	<div class="panel-body"><%=dto.getWname() %></div>
	<div class="panel-heading">제목</div>
	<div class="panel-body"><%=dto.getTitle() %></div>
	<div class="panel-heading">내용</div>
	<div class="panel-body" style='height:170px'><%=dto.getContent() %></div>
	<div class="panel-heading">조회수</div>
	<div class="panel-body"><%=dto.getViewcnt() %></div>
	<div class="panel-heading">등록일</div>
	<div class="panel-body"><%=dto.getWdate() %></div>
</div>
<div>
	<button type="button" class="btn" onclick="location.href='createForm.jsp'">등록</button>
	<button type="button" class="btn" onclick="update('<%=bbsno%>')">수정</button>
	<button type="button" class="btn" onclick="deleteM()">삭제</button>
	<button type="button" class="btn" onclick="location.href='list.jsp'">목록</button>
</div>
</div>
</body>
</html>
```

![image](https://user-images.githubusercontent.com/101780699/170167469-642b05bd-0879-42e0-a291-b850c05d760b.png)

![image](https://user-images.githubusercontent.com/101780699/170175586-f5465d17-1d5b-4618-a5e6-3d792cb55bc6.png)

---

---

2. 패스워드 검사

   (2) DAO passCheck 만들기

```java
	public boolean passCheck(Map map) {
		boolean flag = false;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		ResultSet rs = null;

		StringBuffer sql = new StringBuffer();
		sql.append("  SELECT COUNT(bbsno) as cnt   ");
		sql.append("  FROM bbs 			   ");
		sql.append("  WHERE bbsno	=	?  ");
		sql.append("  AND passwd	=	?  ");

		int bbsno = (int)map.get("bbsno");
		String passwd = (String)map.get("passwd");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setInt(1, bbsno);
			pstmt.setString(2, passwd);

			rs = pstmt.executeQuery();
			rs.next();
			int cnt = rs.getInt("cnt");
			if(cnt>0)flag = true; // 패스워드가 맞다면
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(rs, pstmt, con);
		}

		return flag;
	}
```

---

---

#### 게시판 삭제

삭제처리 위해 패스워드입력 페이지 제작

(1) deleteForm.jsp 만들기

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	BbsDTO dto = dao.read(bbsno);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <style type="text/css">
 	#red{
  	color : red;}
  </style>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">삭제</h1>
<form class="form-horizontal"
      action="deleteProc.jsp"
      method="post"
      >
  <input type="hidden" name="bbsno" value="<%=request.getParameter("bbsno") %>">
    <div class="form-group">
    <label class="control-label col-sm-2" for="passwd">비밀번호</label>
    <div class="col-sm-6">
      <input type="password" name="passwd" id="passwd" class="form-control">
    </div>
  </div>

  <p id="red" class="col-sm-offset-2 col-sm-6">삭제 후 복구할 수 없습니다.</p>


   <div class="form-group">
   <div class="col-sm-offset-2 col-sm-5">
    <button class="btn">삭제</button>
    <button type="reset" class="btn">취소</button>
   </div>
 </div>
</form>
</div>
</body>
</html>
```

(2) read.jsp 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	dao.upViewcnt(bbsno);
	BbsDTO dto = dao.read(bbsno); // 레코드 조회

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script>
  	function update(bbsno){
  		// alert(bbsno);
  		let url = 'updateForm.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  	function del(bbsno){
  		// alert(bbsno);
  		let url = 'deleteForm.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1>조회</h1>
<div class = "panel panel-default">
	<div class="panel-heading">작성자</div>
	<div class="panel-body"><%=dto.getWname() %></div>
	<div class="panel-heading">제목</div>
	<div class="panel-body"><%=dto.getTitle() %></div>
	<div class="panel-heading">내용</div>
	<div class="panel-body" style='height:170px'><%=dto.getContent() %></div>
	<div class="panel-heading">조회수</div>
	<div class="panel-body"><%=dto.getViewcnt() %></div>
	<div class="panel-heading">등록일</div>
	<div class="panel-body"><%=dto.getWdate() %></div>
</div>
<div>
	<button type="button" class="btn" onclick="location.href='createForm.jsp'">등록</button>
	<button type="button" class="btn" onclick="update('<%=bbsno%>')">수정</button>
	<button type="button" class="btn" onclick="del('<%=bbsno%>')">삭제</button>
	<button type="button" class="btn" onclick="location.href='list.jsp'">목록</button>
</div>
</div>
</body>
</html>
```

![image](https://user-images.githubusercontent.com/101780699/170180352-99fa98ef-b791-4a9d-af05-e2f0282ea49e.png)

(3) DAO delete 만들기

```java
	public boolean delete(int bbsno) {
		boolean flag = false;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;

		StringBuffer sql = new StringBuffer();
		sql.append("  delete from bbs  ");
		sql.append("  where bbsno = ?  ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setInt(1, bbsno);

			int cnt = pstmt.executeUpdate();
			if(cnt>0) flag = true;
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}
		return flag;
	}

```

(4) deleteProc.jsp 만들기

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    import="bbs.*, java.util.* "%>

<% request.setCharacterEncoding("utf-8"); %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />

<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	String passwd = request.getParameter("passwd");

	Map map = new HashMap();
	map.put("bbsno", bbsno);
	map.put("passwd", passwd);
	boolean pflag = dao.passCheck(map);
	boolean flag = false;
	if(pflag) {  //올바른 비밀번호

		flag = dao.delete(bbsno);  //수정처리
	}

    %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<jsp:include page="/menu/top.jsp"></jsp:include>
<div class="container">
	<div class="well well-lg">
	<%
		if(!pflag) { //비번 잘못되었을 때
			out.print("잘못된 비밀번호 입니다.");
		} else if(flag){
			out.print("글 삭제 성공입니다.");
		} else {
			out.print("글 삭제 실패입니다.");
		}
	%>
	</div>

	<% if(!pflag) { %>
		<button class = 'btn' onclick="history.back()">다시시도</button>
	<% } %>
	<button class='btn' onclick="location.href='createForm.jsp'">다시등록</button>
	<button class='btn' onclick="location.href='list.jsp'">목록으로</button>
</div>

</body>
</html>
```

![image](https://user-images.githubusercontent.com/101780699/170181604-8f6bcf82-087a-4f9d-bfee-6572023e986d.png)

![image](https://user-images.githubusercontent.com/101780699/170181648-8b13396d-e412-47b6-a496-c192e8a28630.png)

---

---

#### 게시판 답변 처리

SQL문 확인

기존 데이터를 삭제한 후 grpno를 가진 데이터로 추가하기

![image](https://user-images.githubusercontent.com/101780699/170187677-1720e143-8ea7-48e2-b3b1-68fcdaec39cc.png)

DAO create 수정

```java
	public boolean create(BbsDTO dto) {
		boolean flag = false;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		StringBuffer sql = new StringBuffer();
			sql.append(" insert into bbs(wname, title, content, passwd, wdate, grpno) ");
	        sql.append(" values(?,?,?,?,sysdate(),  ");
	        sql.append(" (SELECT ifnull(MAX(grpno),0) + 1 FROM bbs b)) ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setString(1, dto.getWname());
			pstmt.setString(2, dto.getTitle());
			pstmt.setString(3, dto.getContent());
			pstmt.setString(4, dto.getPasswd());

			int cnt = pstmt.executeUpdate();

			if(cnt>0) flag = true;

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}

		return flag;
	}
```

read.jsp 답변 버튼 추가

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));
	dao.upViewcnt(bbsno);
	BbsDTO dto = dao.read(bbsno); // 레코드 조회

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script>
  	function update(bbsno){ // 수정 페이지 이동
  		// alert(bbsno);
  		let url = 'updateForm.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  	function del(bbsno){ // 삭제 페이지 이동
  		// alert(bbsno);
  		let url = 'deleteForm.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  	function reply(bbsno){ // 답변 페이지 이동
  		// alert(bbsno);
  		let url = 'replyForm.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1>조회</h1>
<div class = "panel panel-default">
	<div class="panel-heading">작성자</div>
	<div class="panel-body"><%=dto.getWname() %></div>
	<div class="panel-heading">제목</div>
	<div class="panel-body"><%=dto.getTitle() %></div>
	<div class="panel-heading">내용</div>
	<div class="panel-body" style='height:170px'><%=dto.getContent() %></div>
	<div class="panel-heading">조회수</div>
	<div class="panel-body"><%=dto.getViewcnt() %></div>
	<div class="panel-heading">등록일</div>
	<div class="panel-body"><%=dto.getWdate() %></div>
</div>
<div>
	<button type="button" class="btn" onclick="location.href='createForm.jsp'">등록</button>
	<button type="button" class="btn" onclick="update('<%=bbsno%>')">수정</button>
	<button type="button" class="btn" onclick="del('<%=bbsno%>')">삭제</button>
	<button type="button" class="btn" onclick="reply('<%=bbsno%>')">답변</button>
	<button type="button" class="btn" onclick="location.href='list.jsp'">목록</button>
</div>
</div>
</body>
</html>
```

replyForm.jsp 만들기

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="bbs.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%
    int bbsno = Integer.parseInt(request.getParameter("bbsno"));
 	BbsDTO dto = dao.readReply(bbsno);
 %>

<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 답변</h1>
<form class="form-horizontal"
      action="replyProc.jsp"
      method="post"
      >

  <input type="hidden" name="bbsno" value="<%=dto.getBbsno() %>">
  <input type="hidden" name="grpno" value="<%=dto.getGrpno() %>">
  <input type="hidden" name="indent" value="<%=dto.getIndent() %>">
  <input type="hidden" name="ansnum" value="<%=dto.getAnsnum() %>">

  <div class="form-group">
    <label class="control-label col-sm-2" for="wname">작성자</label>
    <div class="col-sm-6">
      <input type="text" name="wname" id="wname" class="form-control">
    </div>
  </div>
  <div class="form-group">
    <label class="control-label col-sm-2" for="title">제목</label>
    <div class="col-sm-8">
      <input type="text" name="title" id="title"
      class="form-control" value="<%=dto.getTitle()%>">
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="content">내용</label>
    <div class="col-sm-8">
    <textarea rows="12" cols="7" id="content" name="content" class="form-control"></textarea>
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="passwd">비밀번호</label>
    <div class="col-sm-6">
      <input type="password" name="passwd" id="passwd" class="form-control">
    </div>
  </div>

   <div class="form-group">
   <div class="col-sm-offset-2 col-sm-5">
    <button class="btn">등록</button>
    <button type="reset" class="btn">취소</button>
   </div>
 </div>
</form>
</div>
</body>
</html>
```

DAO readReply 추가

```java
	public BbsDTO readReply(int bbsno) {
		BbsDTO dto = null;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		ResultSet rs = null;

		StringBuffer sql = new StringBuffer();
		sql.append("  SELECT bbsno, title, grpno, indent, ansnum ");
		sql.append("  FROM bbs   ");
		sql.append("  WHERE bbsno = ?  ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setInt(1, bbsno);

			rs = pstmt.executeQuery();

			if(rs.next()) {
				dto = new BbsDTO();
				dto.setBbsno(rs.getInt("bbsno"));
				dto.setTitle(rs.getString("title"));
				dto.setGrpno(rs.getInt("grpno"));
				dto.setIndent(rs.getInt("indent"));
				dto.setAnsnum(rs.getInt("ansnum"));
			}

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(rs, pstmt, con);
		}

		return dto;
	}
```

![image](https://user-images.githubusercontent.com/101780699/170190513-0f8fa00e-d878-46e3-8285-e5efade83fa8.png)

---

#### 답변처리 페이지 제작

\- 기존 답변의 순서인 ansnum 값을 변경
\- 답변 생성시 부모의 grpno, indent+1, ansnum+1 로 생성

DAO createReply 추가하기

```java
	public boolean createReply(BbsDTO dto) {
		boolean flag = false;
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		StringBuffer sql = new StringBuffer();
			sql.append(" insert into bbs(wname, title, content, passwd, wdate, grpno, indent, ansnum) ");
	        sql.append(" values(?,?,?,?,sysdate(),?,?,?)  ");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setString(1, dto.getWname());
			pstmt.setString(2, dto.getTitle());
			pstmt.setString(3, dto.getContent());
			pstmt.setString(4, dto.getPasswd());
			pstmt.setInt(5, dto.getGrpno());
			pstmt.setInt(6, dto.getIndent()+1);
			pstmt.setInt(7, dto.getAnsnum()+1);

			int cnt = pstmt.executeUpdate();

			if(cnt>0) flag = true;

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}

		return flag;
	}
```

DAO upAnsnum 추가하기

```java
	public void upAnsnum(Map map) {
		Connection con = DBOpen.getConnection();
		PreparedStatement pstmt = null;
		StringBuffer sql = new StringBuffer();
		sql.append(" update bbs ");
		sql.append(" set ");
		sql.append(" ansnum = ansnum + 1  ");
		sql.append(" where grpno = ? and ansnum > ?   ");

		int grpno = (int)map.get("grpno");
		int ansnum = (int)map.get("ansnum");

		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setInt(1, grpno);
			pstmt.setInt(2, ansnum);

			pstmt.executeUpdate();

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}
	}
```

replyProc.jsp 만들기

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    import="bbs.*, java.util.* "%>

<% request.setCharacterEncoding("utf-8"); %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<jsp:useBean id="dto" class="bbs.BbsDTO" />
<%//  String wname = request.getParameter("wname"); 랑    dto.setWname(wname); 합친 코드 */ %>
<%//  property 에서 '*'를 쓰면 모든 속성 된다.' */ %>
<jsp:setProperty name="dto" property="*" />

<%
	Map map = new HashMap();
	map.put("grpno", dto.getGrpno());
	map.put("ansnum", dto.getAnsnum());
	dao.upAnsnum(map);
	boolean flag = dao.createReply(dto); // 답변
%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<jsp:include page="/menu/top.jsp"></jsp:include>
<div class="container">
	<div class="well well-lg">
	<%
		if(flag){
			out.print("답변 성공입니다.");
		} else {
			out.print("답변 실패입니다.");
		}
	%>
	</div>
	<button class='btn' onclick="location.href='createForm.jsp'">다시등록</button>
	<button class='btn' onclick="location.href='list.jsp'">목록으로</button>
</div>

</body>
</html>
```

list.jsp 수정 td 수정

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*, bbs.BbsDTO, utility.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%

//검색관련--------------
String col = Utility.checkNull(request.getParameter("col"));
String word = Utility.checkNull(request.getParameter("word"));

if(col.equals("total"))word = "";

//페이징 관련---------------
int nowPage = 1;
if(request.getParameter("nowPage") != null){
	nowPage = Integer.parseInt(request.getParameter("nowPage"));
}

int recordPerPage = 5;

int sno = ((nowPage -1) * recordPerPage);
int eno = recordPerPage;

Map map = new HashMap();
map.put("col",col);
map.put("word",word);
map.put("sno",sno);
map.put("eno",eno);

List<BbsDTO> list = dao.list(map);
int total = dao.total(map);
String paging = Utility.paging(total, nowPage, recordPerPage, col, word);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script type ="text/javascript">
  	function read(bbsno){
  		let url = 'read.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<form action="list.jsp" class='form-inline'>
<div class='form-group'>
 <select class='form-control' name='col'>
 	<option value="wname" <%if(col.equals("wname")) out.print("selected");%>>성명</option>
 	<option value="title" <%if(col.equals("title")) out.print("selected");%>>제목</option>
 	<option value="content" <%if(col.equals("content")) out.print("selected");%> >내용</option>
 	<option value="title_content" <%if(col.equals("title_content")) out.print("selected");%>>제목+내용</option>
 	<option value="total" <%if(col.equals("total")) out.print("selected");%>>전체출력</option>
 </select>
</div>
<div class="form-group">
	<input type='text' class='form-control' placeholder='Enter 검색어' name='word' value="<%=word%>">
</div>
<button class='btn btn-default'>검색</button>
<button class='btn btn-default' type='button' onclick="location.href='createForm.jsp'">등록</button>
</form>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
<%  if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

<%  }else {
		for(int i=0 ; i < list.size() ; i++) {
	   	BbsDTO dto = list.get(i);
%>
		<tr>
			<td><%=dto.getBbsno() %></td>
			<td>
				<%
					for(int j=0; j<dto.getIndent(); j++){
						out.print("&nbsp;&nbsp;");
					}
					if(dto.getIndent()>0) out.print("<img src='../images/re.jpg'>"); //re 이미지
				%>
			<a href="javascript:read('<%=dto.getBbsno() %>')"><%=dto.getTitle() %></td>
			<td><%=dto.getWname() %></td>
			<td><%=dto.getWdate() %></td>
			<td><%=dto.getGrpno() %></td>
			<td><%=dto.getIndent() %></td>
			<td><%=dto.getAnsnum() %></td>
		</tr>
<%     } //for end
    } //if end
%>
	</tbody>
</table>
<div>
	<%=paging %>
</div>
</div>
</body>
</html>
```

이미지를 다운받은 후 답변을 작성한 모습

![image](https://user-images.githubusercontent.com/101780699/170197621-65eafe4c-5efb-4a07-a68a-d66a11e454f2.png)

---

---

#### 새로운글에 new 이미지 표시

BbsDAO.java list(map) 메소드에서 wdate 가져오도록 수정

SQL 쿼리문

![image](https://user-images.githubusercontent.com/101780699/170207268-2b27cd80-7019-42d0-8577-d5e3efe40041.png)

utility.java 수정하기

```java
package utility;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.List;

public class Utility {

	public static String checkNull(String str) {
		if(str == null) {
			str = "";
		}
		return str;
	}

/**
 * @param totalRecord 전체 레코드수
 * @param nowPage     현재 페이지
 * @param recordPerPage 페이지당 레코드 수
 * @param col 검색 컬럼
 * @param word 검색어
 * @return 페이징 생성 문자열
 */
public static String paging(int totalRecord, int nowPage, int recordPerPage, String col, String word){
    int pagePerBlock = 5; // 블럭당 페이지 수
    int totalPage = (int)(Math.ceil((double)totalRecord/recordPerPage)); // 전체 페이지
    int totalGrp = (int)(Math.ceil((double)totalPage/pagePerBlock));// 전체 그룹
    int nowGrp = (int)(Math.ceil((double)nowPage/pagePerBlock));    // 현재 그룹
    int startPage = ((nowGrp - 1) * pagePerBlock) + 1; // 특정 그룹의 페이지 목록 시작
    int endPage = (nowGrp * pagePerBlock);             // 특정 그룹의 페이지 목록 종료

    StringBuffer str = new StringBuffer();
    str.append("<div style='text-align:center'>");
    str.append("<ul class='pagination'> ");
    int _nowPage = (nowGrp-1) * pagePerBlock; // 10개 이전 페이지로 이동
    if (nowGrp >= 2){
      str.append("<li><a href='./list.jsp?col="+col+"&word="+word+"&nowPage="+_nowPage+"'>이전</A></li>");
    }

    for(int i=startPage; i<=endPage; i++){
      if (i > totalPage){
        break;
      }

      if (nowPage == i){
        str.append("<li class='active'><a href=#>"+i+"</a></li>");
      }else{
        str.append("<li><a href='./list.jsp?col="+col+"&word="+word+"&nowPage="+i+"'>"+i+"</A></li>");
      }
    }

    _nowPage = (nowGrp * pagePerBlock)+1; // 10개 다음 페이지로 이동
    if (nowGrp < totalGrp){
      str.append("<li><A href='./list.jsp?col="+col+"&word="+word+"&nowPage="+_nowPage+"'>다음</A></li>");
    }
    str.append("</ul>");
    str.append("</div>");

    return str.toString();
 }
public static List<String> getDay(){
    List<String> list = new ArrayList<String>();

    SimpleDateFormat sd = new SimpleDateFormat("yyyy-MM-dd");
    Calendar cal = Calendar.getInstance();
    for(int j = 0; j < 3; j++){
        list.add(sd.format(cal.getTime()));
        cal.add(Calendar.DATE, -1);
    }

    return list;
}
/**
 * 등록날짜와 오늘,어제,그제날짜와 비교
 * @param wdate - 등록날짜
 * @return - true:오늘,어제,그제중 등록날짜와 같음
 *           false:오늘,어제,그제 날짜가 등록날짜와 다 다름
 */
public static boolean compareDay(String wdate){
    boolean flag = false;
    List<String> list = getDay();
    if(wdate.equals(list.get(0))
       || wdate.equals(list.get(1))
       || wdate.equals(list.get(2))){
        flag = true;
    }

    return flag;
}

}
```

list.jsp 수정하기

```jsp
<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*, bbs.BbsDTO, utility.*" %>
<jsp:useBean id="dao" class="bbs.BbsDAO" />
<%

//검색관련--------------
String col = Utility.checkNull(request.getParameter("col"));
String word = Utility.checkNull(request.getParameter("word"));

if(col.equals("total"))word = "";

//페이징 관련---------------
int nowPage = 1;
if(request.getParameter("nowPage") != null){
	nowPage = Integer.parseInt(request.getParameter("nowPage"));
}

int recordPerPage = 5;

int sno = ((nowPage -1) * recordPerPage);
int eno = recordPerPage;

Map map = new HashMap();
map.put("col",col);
map.put("word",word);
map.put("sno",sno);
map.put("eno",eno);

List<BbsDTO> list = dao.list(map);
int total = dao.total(map);
String paging = Utility.paging(total, nowPage, recordPerPage, col, word);

%>
<!DOCTYPE html>
<html>
<head>
  <title>homepage</title>
  <meta charset="utf-8">
  <script type ="text/javascript">
  	function read(bbsno){
  		let url = 'read.jsp?bbsno='+bbsno;
  		location.href = url;
  	}
  </script>
</head>
<body>
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">게시판 목록</h1>
<form action="list.jsp" class='form-inline'>
<div class='form-group'>
 <select class='form-control' name='col'>
 	<option value="wname" <%if(col.equals("wname")) out.print("selected");%>>성명</option>
 	<option value="title" <%if(col.equals("title")) out.print("selected");%>>제목</option>
 	<option value="content" <%if(col.equals("content")) out.print("selected");%> >내용</option>
 	<option value="title_content" <%if(col.equals("title_content")) out.print("selected");%>>제목+내용</option>
 	<option value="total" <%if(col.equals("total")) out.print("selected");%>>전체출력</option>
 </select>
</div>
<div class="form-group">
	<input type='text' class='form-control' placeholder='Enter 검색어' name='word' value="<%=word%>">
</div>
<button class='btn btn-default'>검색</button>
<button class='btn btn-default' type='button' onclick="location.href='createForm.jsp'">등록</button>
</form>
<table class="table table-striped">
	<thead>
		<tr>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th>
			<th>등록날짜</th>
			<th>grpno</th>
			<th>indent</th>
			<th>ansnum</th>
		</tr>
	</thead>
	<tbody>
<%  if(list.size()==0){ %>
	<tr><td colspan='7'>등록된 글이 없습니다.</td></tr>

<%  }else {
		for(int i=0 ; i < list.size() ; i++) {
	   	BbsDTO dto = list.get(i);
%>
		<tr>
			<td><%=dto.getBbsno() %></td>
			<td>
				<%
					for(int j=0; j<dto.getIndent(); j++){
						out.print("&nb sp;&nbsp;");
					}
					if(dto.getIndent()>0) out.print("<img src='../images/re.jpg'>"); //re 이미지
				%>
			<a href="javascript:read('<%=dto.getBbsno() %>')"><%=dto.getTitle() %></a>
			<% if(Utility.compareDay(dto.getWdate())){ %>
				<img src="../images/new.gif">
			<% } %>
			</td>
			<td><%=dto.getWname() %></td>
			<td><%=dto.getWdate() %></td>
			<td><%=dto.getGrpno() %></td>
			<td><%=dto.getIndent() %></td>
			<td><%=dto.getAnsnum() %></td>
		</tr>
<%     } //for end
    } //if end
%>
	</tbody>
</table>
<div>
	<%=paging %>
</div>
</div>
</body>
</html>
```

최근에 작성된 new.gif가 보여지는 모습

![image](https://user-images.githubusercontent.com/101780699/170209078-2fd45fb4-0119-4365-88cd-4f70afa99d79.png)